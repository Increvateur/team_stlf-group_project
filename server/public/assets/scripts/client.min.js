var myApp=angular.module("myApp",["ngRoute","ngAnimate","ui.bootstrap","smart-table"]);myApp.config(["$routeProvider","$locationProvider",function(a,b){a.when("/",{templateUrl:"assets/views/templates/home.html",controller:"HomeController"}).when("/queries",{templateUrl:"assets/views/templates/queries.html",controller:"QueryController"}).when("/failure",{templateUrl:"assets/views/templates/failure.html",controller:"MainController"}).when("/user-admin",{templateUrl:"assets/views/templates/userAdmin.html",controller:"UserController"}).when("/goals",{templateUrl:"assets/views/templates/goals.html",controller:"GoalsController"}).when("/giftRange",{templateUrl:"assets/views/templates/giftRange.html",controller:"GiftRangeController"}).when("/donorRetention",{templateUrl:"assets/views/templates/donorRetention.html",controller:"DonorRetentionController"}).otherwise({redirectTo:"/"}),b.html5Mode(!0)}]),myApp.controller("ChartContentController",["$scope","$uibModalInstance","results","MoneyRaisedService",function(a,b,c,d){var e=d;a.results=c,a.accounts=e.accountArray,a.date=e.endDate.date.getFullYear(),console.log("Inside the actual ChartContentController:single row",a.results),console.log("Inside the actual ChartContentController: all accounts",a.accounts),a.chartType=function(b){"piechart"==b?a.load=a.piechart:"bargraph"==b?a.load=a.bargraph:a.load=a.barchart},a.piechart=function(b){console.log("Pie Chart Data:",b),AmCharts.makeChart("chartdiv",{type:"pie",angle:20,balloonText:"[[title]]<br><span style='font-size:14px'><b>$[[value]]</b> ([[percents]]%)</span>",depth3D:20,titleField:"group",valueField:"money",fontSize:12,theme:"default",allLabels:[],balloon:{},titles:[{id:"goals",size:16,text:"Donations by Individuals "+a.date}],dataProvider:[{group:a.accounts[0].type,money:a.accounts[0].ytd},{group:a.accounts[1].type,money:a.accounts[1].ytd},{group:a.accounts[2].type,money:a.accounts[2].ytd},{group:a.accounts[3].type,money:a.accounts[3].ytd},{group:a.accounts[4].type,money:a.accounts[4].ytd},{group:a.accounts[5].type,money:a.accounts[5].ytd},{group:a.accounts[6].type,money:a.accounts[6].ytd}]})},a.bargraph=function(b){AmCharts.makeChart("chartdiv",{type:"serial",categoryField:"date",autoMarginOffset:40,marginRight:60,marginTop:60,fontSize:13,theme:"default",categoryAxis:{parseDates:!0},chartCursor:{enabled:!0},chartScrollbar:{enabled:!0},trendLines:[],graphs:[{columnWidth:.44,cornerRadiusTop:8,dashLength:4,fillAlphas:.51,id:"AmGraph-1",lineAlpha:.44,title:"graph 1",type:"column",valueField:"column-1"},{bullet:"square",bulletBorderAlpha:1,bulletBorderThickness:1,bulletSize:16,id:"AmGraph-2",lineThickness:3,title:"Goals",valueField:"column-2"}],guides:[],valueAxes:[{id:"ValueAxis-1",title:a.results.type}],allLabels:[],balloon:{},titles:[],dataProvider:[{date:a.date,"column-1":a.results.ytd,"column-2":a.results.goal},{date:a.date-1,"column-1":a.results.ytdM1,"column-2":a.results.goal},{date:a.date-2,"column-1":a.results.ytdM2,"column-2":a.results.goal},{date:a.date-1,"column-1":a.results.tfyM1,"column-2":a.results.goal},{date:a.date-2,"column-1":a.results.tfyM2,"column-2":a.results.goal}]})},a.barchart=function(b){AmCharts.makeChart("chartdiv",{type:"serial",categoryField:"date",angle:30,depth3D:30,startDuration:1,categoryAxis:{gridPosition:"start"},trendLines:[],graphs:[{balloonText:"[[title]] of [[category]]:[[value]]",fillAlphas:.85,id:"AmGraph-1",title:"Donations",type:"column",clustered:!1,valueField:"Donations",colorField:"color",lineAlpha:.1,topRadius:.85},{balloonText:"[[title]] of [[category]]:[[value]]",fillAlphas:.85,id:"AmGraph-2",title:"Goals",columnWidth:.5,clustered:!1,type:"column",valueField:"Goal",colorField:"colorTwo",lineAlpha:.1,topRadius:.85}],guides:[],valueAxes:[{id:"ValueAxis-1",clustered:!1,title:""}],allLabels:[],balloon:{},legend:{enabled:!0,useGraphSettings:!0},titles:[{id:"Title-1",size:15,text:a.results.type,color:"#333333"}],dataProvider:[{date:a.date+" ytd",Donations:a.results.ytd,Goal:a.results.goal,color:"#04D215",colorTwo:"#754DEB"},{date:a.date-1+" ytd",Donations:a.results.ytdM1,color:"#2A0CD0"},{date:a.date-2+" ytd",Donations:a.results.ytdM2,color:"#333333"},{date:a.date-1+" fy",Donations:a.results.tfyM1,color:"#2A0CD0"},{date:a.date-2+" fy",Donations:a.results.tfyM2,color:"#FF0F00"}]})},a.load=a.barchart,a.close=function(){b.close()}}]),myApp.controller("DonorRetentionController",["$scope","$filter","$uibModal","DonorRetentionService",function(a,b,c,d){var e=d,f=new Date,g=new Date;a.rowCollection=[],a.itemsByPage=15,a.accounts=[],a.data=[],a.forceData=[],a.forceresponse=[],a.retained=[],a.recovered=[],a.universe=[],a.date=g.getFullYear(),a.endDate=e.endDate,e.getDonors(),a.data=e.data,a.forceData=e.forceData,a.forceresponse=e.forceresponse,a.retained=e.retainedDonorsArray,a.recovered=e.recoveredDonorsArray,a.universe=e.universeArray,a.open=function(a,b){c.open({animation:!0,templateUrl:"./assets/views/routes/chartContent.html",controller:"ChartContentController",size:a,keyboard:!0,backdrop:"static",resolve:{results:function(){return b}}})},a.today=function(){a.dt=new Date},a.today(),a.clear=function(){a.dt=null},a.dateOptions={formatYear:"yy",maxDate:new Date,minDate:null,startingDay:1},a.open1=function(){a.popup1.opened=!0},a.setDate=function(b,c,d){a.dt=new Date(b,c,d)},a.popup1={opened:!1},a.setEndDate=function(b){b.getMonth()<8?a.date=b.getFullYear():a.date=b.getFullYear()+1,console.log("date display",a.date),f=b,e.setEndDate(f)}}]),myApp.controller("GiftRangeController",["$scope","$filter","$uibModal","GiftRangeService",function(a,b,c,d){var e=d,f=new Date,g=new Date;a.rowCollection=[],a.itemsByPage=15,a.gifts=[],a.data=[],a.forceData=[],a.forceresponse=[],a.amountRaised=[],a.date=g.getFullYear(),a.endDate=e.endDate,e.giftRange(),a.gifts=e.giftArray,a.amountRaised=e.amountRaised,a.open=function(a,b){c.open({animation:!0,templateUrl:"./assets/views/routes/chartContent.html",controller:"ChartContentController",size:a,keyboard:!0,backdrop:"static",resolve:{results:function(){return b}}})},a.today=function(){a.dt=new Date},a.today(),a.clear=function(){a.dt=null},a.dateOptions={formatYear:"yy",maxDate:new Date,minDate:null,startingDay:1},a.open1=function(){a.popup1.opened=!0},a.setDate=function(b,c,d){a.dt=new Date(b,c,d)},a.popup1={opened:!1},a.setEndDate=function(b){b.getMonth()<8?a.date=b.getFullYear():a.date=b.getFullYear()+1,console.log("date display",a.date),f=b,e.setEndDate(f)}}]),myApp.controller("GoalsController",["$scope","GoalService",function(a,b){function c(){d.getGoals().then(function(b){a.goalsArray=b,console.log("*** == @GoalsController - $scope.goalsArray: ",a.goalsArray)})}console.log("HI, @CONTROLLER - GoalsController Works!");var d=b;a.goals={},a.showYear=!1,a.submitGoals=!0,a.changeGoals=!0,c(),a.addYear=function(){a.goals={},a.fiscalyear="",a.showYear=!0},a.yearArray=[],d.setYearList(),console.log("<<< CURRENT YEAR & YEARS >>> : ",d.currentYear,d.years),a.yearArray=d.years,console.log("// === @GoalsController - $scope.yearArray: ",a.yearArray),a.monthsObj={months:[{name:"September",key:"september"},{name:"October",key:"october"},{name:"November",key:"november"},{name:"December",key:"december"},{name:"January",key:"january"},{name:"February",key:"february"},{name:"March",key:"march"},{name:"April",key:"april"},{name:"May",key:"may"},{name:"June",key:"june"},{name:"July",key:"july"},{name:"August",key:"august"}]},a.indTotal=0,a.yearlyTotal=0,a.fiscalyear="",a.fiscalYear=function(b){console.log("/////// year: ",b),a.fiscalyear=parseInt(b);var c=a.fiscalyear;a.goals.fiscal_year=c,a.findYear()},a.addFyKey=function(b){a.fiscalyear=parseInt(b);var c=a.fiscalyear;a.goals.fiscal_year=c,a.showYear=!1,a.fiscalyear=0,a.changeGoals=!0,a.submitGoals=!1,console.log("#$#$ = @goalsController in addFyKey() year, ",b,"fy, ",c,"$scope.fiscalyear, ",a.fiscalyear,"and $scope.goals.fiscalyear",a.goals.fiscal_year)},a.findYear=function(){console.log("HI, FISCAL YEAR: ",a.goals.fiscal_year),d.getSpecificYear(a.goals.fiscal_year).then(function(b){b.fiscal_year===a.fiscalyear?(console.log("||| ---- @goalsController.js in getSpecificYear() after return from Service - $scope.fiscalyear: ",a.fiscalyear),a.goals=b,a.changeGoals=!1,a.submitGoals=!0,console.log("~~~~~~~~~~~~~~~~~~~<- $scope.goals: ",a.goals)):(console.log("........ @goalsController.js in getSpecificYear() else after return from Service - $scope.fiscalyear: ",a.fiscalyear),a.goals={},a.goals.fiscal_year=a.fiscalyear,console.log("~~~~~~~~~~~~~~~~~~~<- $scope.goals: ",a.goals))})},a.updateGoals=function(b){console.log("----_U @goalsController in updateGoals() - data: ",b),d.updateGoals(b),a.goals={},c()},a.saveGoals=function(b){console.log("@goalController.js fiscalyear: ",a.fiscalyear),console.log("! @goalController in saveGoals - data: ",b),d.newGoals(b),a.goals={},d.getGoals(),c()},a.clearForm=function(){a.goals={},a.fiscalyear=0,a.showYear=!1,a.submitGoals=!0,a.changeGoals=!0},a.individualTotal=0,a.calcTotals=function(){console.log("=_-_= @goalsController in calcTotals"),a.goals.yearly_totals={};var b=a.goals,c=b.months,d=b.yearly_totals;console.log("~~ - ~~ @goalsController in calcTotals - goals, months, yearly_totals: ",b,c,d);var e,f,g,h,i=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0,t=0,u=0,v=0,w=0;for(h in c){f=c[h],console.log("~~~~ @@goalsController in for loop of calcTotals - month: ",f);var x=f.staff;isNaN(x)&&(x=0);var y=f.board;isNaN(y)&&(y=0);var z=f.committee;isNaN(z)&&(z=0);var A=f.parent;isNaN(A)&&(A=0);var B=f.alum;isNaN(B)&&(B=0);var C=f.participant;isNaN(C)&&(C=0);var D=f.community;isNaN(D)&&(D=0);var E=f.corporate_organization;isNaN(E)&&(E=0);var F=f.corporate_match;isNaN(F)&&(F=0);var G=f.corporate_foundation;isNaN(G)&&(G=0);var H=f.family_foundation;isNaN(H)&&(H=0);var I=f.general_foundation;isNaN(I)&&(I=0);var J=x+y+z+A+B+C+D;f.individual_total=J;var K=E+F;f.corporate_total=K;var L=G+H+I;f.foundation_total=L,console.log("HERE IS THE FOR LOOP @goalsController calcTotals() - months[i].all: ",x,y,z,A,B,C,D,J,E,F,K,L,G,H,I),g=J+K+L,console.log("% %  %   @@@goalsController in calcTotals - monthlyTotal in for loop: ",g),console.log("** - = @goalsController in calcTotals - $scope.goals: ",a.goals),f.monthly_total=g,i+=f.staff,console.log("+++ @goalsController in loop - staffTotal: ",i),d.staff_year=i,j+=f.board,d.board_year=j,k+=f.committee,d.committee_year=k,l+=f.parent,d.parent_year=l,m+=f.alum,d.alum_year=m,n+=f.participant,d.participant_year=n,o+=f.community,d.community_year=o,p+=f.individual_total,d.individual_year=p,r+=f.corporate_organization,d.corporate_organization_year=r,s+=f.corporate_match,d.corporate_match_year=s,q+=f.corporate_total,d.corporate_year=q,u+=f.corporate_foundation,d.corporate_foundation_year=u,v+=f.family_foundation,d.family_foundation_year=v,w+=f.general_foundation,d.general_foundation_year=w,t+=f.foundation_total,d.foundation_year=t,e=p+q+t,console.log("! - H E L L O  @goalsController in calcTotals in loop - yearlyTotal: ",e),d.year_total=e}}}]),myApp.controller("HomeController",["$scope","$filter","$uibModal","MoneyRaisedService","GoalService",function(a,b,c,d,e){var f=d,g=e,h=new Date,i=new Date;a.rowCollection=[],a.itemsByPage=15,a.accounts=[],a.data=[],a.forceData=[],a.forceresponse=[],a.goals=[],a.date=i.getFullYear(),a.endDate=f.endDate,a.getGoals=function(){a.goals=g.getGoals()},a.buildtable=function(){a.accounts=f.accountArray},a.open=function(a,b){console.log("Inside the Chart Open Function:",b);c.open({animation:!0,templateUrl:"./assets/views/routes/chartContent.html",controller:"ChartContentController",size:a,keyboard:!0,backdrop:"static",resolve:{results:function(){return b}}})},a.today=function(){a.dt=new Date},a.today(),a.clear=function(){a.dt=null},a.dateOptions={formatYear:"yy",maxDate:new Date,minDate:null,startingDay:1},a.open1=function(){a.popup1.opened=!0},a.setDate=function(b,c,d){a.dt=new Date(b,c,d)},a.popup1={opened:!1},a.setEndDate=function(b){b.getMonth()<8?a.date=b.getFullYear():a.date=b.getFullYear()+1,console.log("date display",a.date),h=b,f.setEndDate(h)},f.getTotals(),f.moneyRaised(),a.data=f.data,a.forceData=f.forceData,a.forceresponse=f.forceresponse,a.buildtable()}]),myApp.controller("loginController",["$scope","$uibModalInstance",function(a,b){a.close=function(){b.close()}}]),myApp.controller("MainController",["$scope","UserService","$uibModal",function(a,b,c){var d=b;d.verifyUser().then(function(b){b.authenticated?(b.admin===!0?a.admin=!0:a.admin=!1,a.login=!0,a.user=b):(a.admin=!1,a.login=!1)}),a.open=function(a){c.open({animation:!0,templateUrl:"./assets/views/routes/loginModal.html",controller:"loginController",size:a,keyboard:!0})},a.logout=function(){d.logout()}}]),myApp.controller("QueryController",["$scope","QueryService",function(a,b){console.log("QueryControllerWorks"),a.data=[],a.forceData=[],a.forceresponse=[];b.getSalesforce(),a.data=b.data,a.forceData=b.forceData,console.log("forcedata",b.forceData),console.log("forcedata arrResults",b.forceData.arrResults),a.forceresponse=b.forceresponse}]),myApp.controller("UserController",["$scope","UserService","$timeout",function(a,b,c){function d(){a.stlfuser={},a.stlfuser.admin=!1,a.add=!0,a.save=!0,a["delete"]=!0,a.clear=!0,a.username=!1,a.modify=!1,a.selected=!1}var e=b;d(),e.getUsers().then(function(b){a.userList=b}),a.selectedUser=function(b){e.getUserData(b).then(function(b){a.stlfuser=b.data,a.stlfuser.password="",console.log("User Data:",a.stlfuser),a.selected=!0,a.clear=!1,a.save=!1,a["delete"]=!1,a.add=!0,a.username=!0,a.modify=!1})},a.submit=function(b){e.newUser(b).then(function(b){a.userList=b,a.showAddAlert=!0,d()})},a.changed=function(){a.selected===!0?(a.add=!0,a["delete"]=!1,a.save=!1):(a.add=!1,a.save=!0,a.clear=!1,a["delete"]=!0)},a.resetForm=function(){d()},a.enableUsername=function(){a.username===!0?a.username=!1:a.username=!0},a.updateUser=function(){e.updateUser(a.stlfuser).then(function(b){a.userList=b,a.showChangeAlert=!0,d()})},a.deleteUser=function(){e.deleteUser(a.stlfuser).then(function(b){a.userList=b,a.showDeleteAlert=!0,d()})},a.closeAlert=function(){a.showAddAlert=!1,a.showDeleteAlert=!1}}]),myApp.factory("DonorRetentionService",["$http",function(a){var b={},c={},d={},e=[],f=[],g=0,h="",i=[],j=[],k=[],l={},m={},n={},o={},p={},q={},r={},s={},t={},u={},v={},w=new Date,x=new Date,y=new Date,z=new Date,A=new Date,B=new Date,C=new Date,D=new Date,E=new Date,F=new Date,G=new Date,H=new Date,I=new Date,J=new Date,K=new Date,L=new Date,M=new Date,N={};N.date=new Date;var O=function(a){N.date=a,P(N),Q()},P=function(a){console.log("enddate object in set dates",a),date=a.date;var b=new Date(date);console.log("date in query",b),x=new Date(b),w=new Date("09/01/"+b.getFullYear()),w>x&&(w=new Date("09/01/"+(b.getFullYear()-1))),y=new Date(w),y.add({years:-1}),A=new Date(w),A.add({years:-2}),ytdM3Start=new Date(w),ytdM3Start.add({years:-3}),ytdM4Start=new Date(w),ytdM4Start.add({years:-4}),z=new Date(x),z.add({years:-1}),B=new Date(x),B.add({years:-2}),C=new Date(x),C.add({years:-3}),D=new Date(x),D.add({years:-4}),F=new Date("08/31/"+b.getFullYear()),F>b&&(F=new Date("08/31/"+(b.getFullYear()-1))),H=new Date(F),H.add({years:-1}),J=new Date(F),J.add({years:-2}),L=new Date(F),L.add({years:-3}),M=new Date(F),M.add({years:-4}),E=new Date(y),G=new Date(A),I=new Date(ytdM3Start),K=new Date(ytdM4Start),b=b.toFormat("YYYY-MM-DD"),w=w.toFormat("YYYY-MM-DD"),x=x.toFormat("YYYY-MM-DD"),y=y.toFormat("YYYY-MM-DD"),z=z.toFormat("YYYY-MM-DD"),A=A.toFormat("YYYY-MM-DD"),B=B.toFormat("YYYY-MM-DD"),ytdM3Start=ytdM3Start.toFormat("YYYY-MM-DD"),C=C.toFormat("YYYY-MM-DD"),ytdM4Start=ytdM4Start.toFormat("YYYY-MM-DD"),D=D.toFormat("YYYY-MM-DD"),E=E.toFormat("YYYY-MM-DD"),F=F.toFormat("YYYY-MM-DD"),G=G.toFormat("YYYY-MM-DD"),H=H.toFormat("YYYY-MM-DD"),I=I.toFormat("YYYY-MM-DD"),J=J.toFormat("YYYY-MM-DD"),K=K.toFormat("YYYY-MM-DD"),L=L.toFormat("YYYY-MM-DD"),M=M.toFormat("YYYY-MM-DD"),console.log("selEndDate",b),console.log("ytdStart",w),console.log("ytdEnd",x),console.log("ytdM1Start",y),console.log("ytdM1End",z),console.log("ytdM2Start",A),console.log("ytdM2End",B),console.log("ytdM3Start",ytdM3Start),console.log("ytdM3End",C),console.log("ytdM4Start",ytdM4Start),console.log("ytdM4End",D),console.log("fyM1Start",E),console.log("fyM1End",F),console.log("fyM2Start",G),console.log("fyM2End",H),console.log("fyM3Start",I),console.log("fyM3End",J),console.log("fyM4Start",K),console.log("fyM4End",L),console.log("fyM5End",M)};P(N);var Q=function(){myKey="c1",h="SELECT  COUNT(Id) FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' GROUP BY AccountId HAVING MIN(CloseDate) >= "+w+" AND MIN(CloseDate) <= "+x,sqlObj={key:myKey,query:"first time donors  YTD SELECTED",sql:h},f.push(sqlObj),myKey="c2",h="SELECT  COUNT(Id) FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' GROUP BY AccountId HAVING MIN(CloseDate) >= "+y+" AND MIN(CloseDate) <= "+z,sqlObj={key:myKey,query:"first time donors  YTD SELECTED -1",sql:h},f.push(sqlObj),myKey="c3",h="SELECT  COUNT(Id) FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' GROUP BY AccountId HAVING MIN(CloseDate) >= "+A+" AND MIN(CloseDate) <= "+B,sqlObj={key:myKey,query:"first time donors  YTD SELECTED -2",sql:h},f.push(sqlObj),myKey="c4",h="SELECT  COUNT(Id) FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' GROUP BY AccountId HAVING MIN(CloseDate) >= "+E+" AND MIN(CloseDate) <= "+F,sqlObj={key:myKey,query:"first time donors  First FY before selected",sql:h},f.push(sqlObj),myKey="c5",h="SELECT  COUNT(Id) FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' GROUP BY AccountId HAVING MIN(CloseDate) >= "+G+" AND MIN(CloseDate) <= "+H,sqlObj={key:myKey,query:"first time donors  Second FY before selected",sql:h},f.push(sqlObj),myKey="d1",h="SELECT Id, Name FROM Account WHERE Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate >= "+w+" AND CloseDate < ="+x+")",h+="AND  Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate > ="+G+" AND CloseDate < ="+F+") ",sqlObj={key:myKey,query:"CURRENT RETAINED YTD new def",sql:h},f.push(sqlObj),myKey="d2",h="SELECT Id, Name FROM Account WHERE Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate >= "+y+" AND CloseDate <= "+z+")",h+="AND  Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate >= "+I+" AND CloseDate <= "+H+") ",sqlObj={key:myKey,query:"CURRENT RETAINED YTD-1 new def",sql:h},f.push(sqlObj),myKey="d3",h="SELECT Id, Name FROM Account WHERE Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate >= "+A+" AND CloseDate <= "+B+")",h+="AND  Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate >= "+K+" AND CloseDate <= "+J+") ",sqlObj={key:myKey,query:"CURRENT RETAINED YTD-2 new def",sql:h},f.push(sqlObj),myKey="d4",h="SELECT Id, Name FROM Account WHERE Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate >= "+E+" AND CloseDate <= "+F+")",h+="AND  Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate > ="+I+" AND CloseDate <= "+H+") ",sqlObj={key:myKey,query:"CURRENT RETAINED FYM1",sql:h},f.push(sqlObj),myKey="d5",h="SELECT Id, Name FROM Account WHERE Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate >= "+G+" AND CloseDate <= "+H+")",h+="AND  Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate > ="+K+" AND CloseDate <= "+J+") ",sqlObj={key:myKey,query:"CURRENT RETAINED FYM2",sql:h},f.push(sqlObj),myKey="e1",h="SELECT Id, Name FROM Account WHERE Id NOT IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate >= "+w+" AND CloseDate <= "+x+")",h+="AND  Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate >= "+G+" AND CloseDate < ="+F+") ",sqlObj={key:myKey,query:"l2ybnty YTD new def",sql:h},f.push(sqlObj),myKey="e2",h="SELECT Id, Name FROM Account WHERE Id NOT IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate >= "+y+" AND CloseDate <= "+z+")",h+="AND  Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate >= "+I+" AND CloseDate <= "+H+") ",sqlObj={key:myKey,query:"l2ybnty YTD-1 new def",sql:h},f.push(sqlObj),myKey="e3",h="SELECT Id, Name FROM Account WHERE Id NOT IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate >= "+A+" AND CloseDate <= "+B+")",h+="AND  Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate >= "+K+" AND CloseDate <= "+J+") ",sqlObj={key:myKey,query:"l2ybnty YTD-2 new def",sql:h},f.push(sqlObj),myKey="e4",h="SELECT Id, Name FROM Account WHERE Id NOT IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate >= "+E+" AND CloseDate <= "+F+")",h+="AND  Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate >= "+I+" AND CloseDate <= "+H+") ",sqlObj={key:myKey,query:"l2ybnty FYM1",sql:h},f.push(sqlObj),myKey="e5",h="SELECT Id, Name FROM Account WHERE Id NOT IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate >= "+G+" AND CloseDate <= "+H+")",h+="AND  Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate >= "+K+" AND CloseDate <= "+J+") ",sqlObj={key:myKey,query:"l2ybnty FYM2",sql:h},f.push(sqlObj),myKey="f1a",h="SELECT Id, Name FROM Account WHERE Id  IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate > "+w+" AND CloseDate < "+x+")",h+="AND  Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate < "+J+") ",sqlObj={key:myKey,query:"donated in sel yetd, AND  sometime prior to the previous two fiscal years",sql:h},f.push(sqlObj),myKey="f1b",h="SELECT Id, Name FROM Account WHERE Id  IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate > "+G+" AND CloseDate < "+F+")",sqlObj={key:myKey,query:"donated in the previous 2 fiscal years",sql:h},f.push(sqlObj),myKey="f2a",h="SELECT Id, Name FROM Account WHERE Id  IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate > "+y+" AND CloseDate < "+z+")",h+="AND  Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate < "+L+") ",sqlObj={key:myKey,query:"donated in sel yetd-1, AND  sometime prior to the previous two fiscal years",sql:h},f.push(sqlObj),myKey="f2b",h="SELECT Id, Name FROM Account WHERE Id  IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate > "+I+" AND CloseDate < "+H+")",sqlObj={key:myKey,query:"donated in the previous 2 fiscal years",sql:h},f.push(sqlObj),myKey="f3a",h="SELECT Id, Name FROM Account WHERE Id  IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate > "+A+" AND CloseDate < "+B+")",h+="AND  Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate < "+M+") ",sqlObj={key:myKey,query:"donated in sel yetd-1, AND  sometime prior to the previous two fiscal years",sql:h},f.push(sqlObj),myKey="f3b",h="SELECT Id, Name FROM Account WHERE Id  IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate > "+K+" AND CloseDate < "+J+")",sqlObj={key:myKey,query:"donated in the previous 2 fiscal years",sql:h},f.push(sqlObj),myKey="f4a",h="SELECT Id, Name FROM Account WHERE Id  IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate > "+E+" AND CloseDate < "+F+")",h+="AND  Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate < "+I+") ",sqlObj={key:myKey,query:"donated in sel yetd-1, AND  sometime prior to the previous two fiscal years",sql:h},f.push(sqlObj),myKey="f5a",h="SELECT Id, Name FROM Account WHERE Id  IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate > "+G+" AND CloseDate < "+H+")",h+="AND  Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate < "+K+") ",sqlObj={key:myKey,query:"donated in sel yetd-1, AND  sometime prior to the previous two fiscal years",sql:h},f.push(sqlObj),myKey="g1",h="SELECT AccountId,  COUNT(Id) FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' GROUP BY AccountId HAVING MAX(CloseDate) <= "+J,sqlObj={key:myKey,query:"lost ytd (how is this yeartd)",sql:h},f.push(sqlObj),myKey="g2",h="SELECT  COUNT(Id) FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' GROUP BY AccountId HAVING MAX(CloseDate) <= "+L,sqlObj={key:myKey,query:"lost ytd-1 (how is this yeartd)",sql:h},f.push(sqlObj),myKey="g3",h="SELECT  COUNT(Id) FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' GROUP BY AccountId HAVING MAX(CloseDate) <= "+M,sqlObj={key:myKey,query:"lost ytd-2 (how is this yeartd)",sql:h},f.push(sqlObj),R()},R=function(b){c.accessToken?(console.log("DID NOT reauthroize"),S()):(console.log("I want to do a check in getSalesforce to see if I need to auth. ",c.accessToken),a.get("/salesforce/force").then(function(a){c.response=a.data,c.accessToken=a.data.accessToken,c.instanceUrl=a.data.instanceUrl,S()}))},S=function(b){return console.log("in fetch force, forceResult=",b),b&&(e.push(b.data),g=e.length,console.log("sql index",g),e.length==f.length)?(console.log("Hey! In fetchForce in queryService, I think we are done!"),d.arrResults=e,T(),void console.log(d)):void a.get("/salesforce/fetch",{params:{accessToken:c.accessToken,instanceUrl:c.instanceUrl,key:f[g].key,strSql:f[g].sql,queryInfo:f[g].query}}).then(function(a){S(a)})},T=function(){console.log("Hey we are totally in parseResults"),console.log("Donor	Acquistion	&	Retention"),console.log("first time donors");var a=V("c1"),b=V("c2"),c=V("c3"),d=V("c4"),e=V("c5");l={type:"First Time Donors",ytd:a,ytdM1:b,ytdM2:c,tfyM1:d,tfyM2:e},i[0]=l,console.log("Current retained donors");var f=V("d1"),g=V("d2"),h=V("d3"),w=V("d4"),x=V("d5");m={type:"Current Retained Donors",ytd:f,ytdM1:g,ytdM2:h,tfyM1:w,tfyM2:x},i[1]=m,console.log("L2YBNTY");var y=V("e1"),z=V("e2"),A=V("e3"),B=V("e4"),C=V("e5");n={type:"L2YBNTY",ytd:y,ytdM1:z,ytdM2:A,tfyM1:B,tfyM2:C},i[2]=n,console.log("Total current donor pool");var D=a+f+y,E=b+g+z,F=c+h+A,G=d+w+B,H=e+x+C;o={type:"Total Current Donor Pool",ytd:D,ytdM1:E,ytdM2:F,tfyM1:G,tfyM2:H},i[3]=o,console.log("Current retained donors percentage");var I=f/D*100,J=g/E*100,K=h/F*100,L=w/G*100,M=x/H*100;p={type:"% Current Retained Donors",ytd:I,ytdM1:J,ytdM2:K,tfyM1:L,tfyM2:M},i[4]=p,console.log("retained array in function",i),console.log("Recovered Donors");var N=U("f1a","f1b"),O=U("f2a","f2b"),P=U("f3a","f3b"),Q=U("f4a","f2b"),R=U("f5a","f3b");q={type:"Recovered Donors",ytd:N,ytdM1:O,ytdM2:P,tfyM1:Q,tfyM2:R},j[0]=q,console.log("Lost Donors");var S=V("g1"),T=V("g2"),W=V("g3"),X=V("g1"),Y=V("g2");r={type:"Lost Donors",ytd:S,ytdM1:T,ytdM2:W,tfyM1:X,tfyM2:Y},j[1]=r,console.log("Total lost recovery  pool");var Z=N+S,$=O+T,_=P+W,aa=Q+X,ba=R+Y;s={type:"Total Lost/Recovery Pool",ytd:Z,ytdM1:$,ytdM2:_,tfyM1:aa,tfyM2:ba},j[2]=s,console.log("Percentage donors recovered");var ca=N/S*100,da=O/T*100,ea=P/W*100,fa=Q/X*100,ga=R/Y*100;t={type:"% of Donors Recovered",ytd:ca,ytdM1:da,ytdM2:ea,tfyM1:fa,tfyM2:ga},j[3]=t,console.log("recovered array in function",j),console.log("Donor Universe");var ha=D+Z,ia=E+$,ja=F+_,ka=G+aa,la=H+ba;u={type:"Total Donor Universe",ytd:ha,ytdM1:ia,ytdM2:ja,tfyM1:ka,tfyM2:la},k[0]=u,console.log("Percentage retained donors");var ma=ha/f,na=ia/g,oa=ja/h,pa=ka/w,qa=la/x;v={type:"% of Retained Donors",ytd:ma,ytdM1:na,ytdM2:oa,tfyM1:pa,tfyM2:qa},k[1]=v,console.log("universeArray",k)},U=function(a,b){for(var c=[],d=[],f=0;f<e.length;f++)e[f].myKey==a&&(c=e[f].result.records),e[f].myKey==b&&(d=e[f].result.records);for(f=0;f<d.length;f++)for(var g=0;g<c.length;g++)c[g].Id==d[f].Id&&c.splice(g,1);return c.length},V=function(a){for(var b=0,c=0;c<e.length;c++)e[c].myKey==a&&(b=e[c].count);return b};return{getSalesforce:R,getDonors:Q,data:b,forceData:d,forceresponse:c,arrResults:e,fetchForce:S,retainedDonorsArray:i,recoveredDonorsArray:j,universeArray:k,setEndDate:O,endDate:N}}]),myApp.factory("GiftRangeService",["$http",function(a){function b(a,b,c,d,e,f){this.type=a,this.ytd=b,this.ytdM1=c,this.ytdM2=d,this.tfyM1=e,this.tfyM2=f}var c={},d={},e={},f=[],g=[],h=0,i="",j="",k=[],l=[],m={},n={},o={},p={},q={},r=new Date,s=new Date,t=new Date,u=new Date,v=new Date,w=new Date,y=new Date,z=new Date,A=new Date,B=new Date,C={};C.date=new Date;var D=function(a){C.date=a,E(C),F()},E=function(a){console.log("enddate object in set dates",a),date=a.date;var b=new Date(date);console.log("date in query",b),s=new Date(b),r=new Date("09/01/"+b.getFullYear()),r>s&&(r=new Date("09/01/"+(b.getFullYear()-1))),t=new Date(r),t.add({years:-1}),v=new Date(r),v.add({years:-2}),u=new Date(s),u.add({years:-1}),w=new Date(s),w.add({years:-2}),z=new Date("08/31/"+b.getFullYear()),z>b&&(z=new Date("08/31/"+(b.getFullYear()-1))),B=new Date(z),B.add({years:-1}),y=new Date(t),A=new Date(v),b=b.toFormat("YYYY-MM-DD"),r=r.toFormat("YYYY-MM-DD"),s=s.toFormat("YYYY-MM-DD"),t=t.toFormat("YYYY-MM-DD"),u=u.toFormat("YYYY-MM-DD"),v=v.toFormat("YYYY-MM-DD"),w=w.toFormat("YYYY-MM-DD"),y=y.toFormat("YYYY-MM-DD"),z=z.toFormat("YYYY-MM-DD"),A=A.toFormat("YYYY-MM-DD"),B=B.toFormat("YYYY-MM-DD")};E(C);var F=function(){j="m1",i="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate >="+r+" AND CloseDate < ="+s+" GROUP BY AccountId HAVING ( SUM(Amount) <= 95 )  ",sqlObj={key:j,query:"Base",sql:i},g.push(sqlObj),j="m2",i="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate >= "+t+" AND CloseDate < ="+u+" GROUP BY AccountId HAVING ( SUM(Amount) <= 95  )  ",sqlObj={key:j,query:"BASE donors Selected YTD -1",sql:i},g.push(sqlObj),j="m3",i="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+v+" AND CloseDate < ="+w+" GROUP BY AccountId HAVING ( SUM(Amount) <= 95 )  ",sqlObj={key:j,query:"BASE donors Selected YTD -2",sql:i},g.push(sqlObj),j="m4",i="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+y+" AND CloseDate < ="+z+" GROUP BY AccountId HAVING ( SUM(Amount) <= 95 )  ",sqlObj={key:j,query:"BASE donors first FY before selected",sql:i},g.push(sqlObj),j="m5",i="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+A+" AND CloseDate < ="+B+" GROUP BY AccountId HAVING ( SUM(Amount) <= 95 )  ",
sqlObj={key:j,query:"BASE donors SECOND FY before selected",sql:i},g.push(sqlObj),j="n1",i="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+r+" AND CloseDate < ="+s+" GROUP BY AccountId HAVING ( SUM(Amount) < 400 AND SUM(Amount) > 95 )  ",sqlObj={key:j,query:"Intermediate",sql:i},g.push(sqlObj),j="n2",i="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+t+" AND CloseDate < ="+u+" GROUP BY AccountId HAVING ( SUM(Amount) < 400 AND SUM(Amount) > 95 )  ",sqlObj={key:j,query:"INTERMEDIATE donors Selected YTD -1",sql:i},g.push(sqlObj),j="n3",i="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+v+" AND CloseDate < ="+w+" GROUP BY AccountId HAVING ( SUM(Amount) < 400 AND SUM(Amount) > 95 )  ",sqlObj={key:j,query:"INTERMEDIATE donors Selected YTD -2",sql:i},g.push(sqlObj),j="n4",i="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+y+" AND CloseDate < ="+z+" GROUP BY AccountId HAVING ( SUM(Amount) < 400 AND SUM(Amount) > 95 ) ",sqlObj={key:j,query:"INTERMEDIATE donors first FY before selected",sql:i},g.push(sqlObj),j="n5",i="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+A+" AND CloseDate < ="+B+" GROUP BY AccountId HAVING ( SUM(Amount) < 400 AND SUM(Amount) > 95 )  ",sqlObj={key:j,query:"INTERMEDIATE donors SECOND FY before selected",sql:i},g.push(sqlObj),j="o1",i="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+r+" AND CloseDate < ="+s+" GROUP BY AccountId HAVING ( SUM(Amount) < 1000 AND SUM(Amount) >= 400 )  ",sqlObj={key:j,query:"Large",sql:i},g.push(sqlObj),j="o2",i="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+t+" AND CloseDate < ="+u+" GROUP BY AccountId HAVING ( SUM(Amount) < 1000 AND SUM(Amount) >= 400 )  ",sqlObj={key:j,query:"LARGE donors Selected YTD -1",sql:i},g.push(sqlObj),j="o3",i="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+v+" AND CloseDate < ="+w+" GROUP BY AccountId HAVING ( SUM(Amount) < 1000 AND SUM(Amount) >= 400 )  ",sqlObj={key:j,query:"LARGE donors Selected YTD -2",sql:i},g.push(sqlObj),j="o4",i="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+y+" AND CloseDate < ="+z+" GROUP BY AccountId HAVING ( SUM(Amount) < 1000 AND SUM(Amount) >= 400 ) ",sqlObj={key:j,query:"LARGE donors first FY before selected",sql:i},g.push(sqlObj),j="o5",i="SELECT   COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+A+" AND CloseDate < ="+B+" GROUP BY AccountId HAVING ( SUM(Amount) < 1000 AND SUM(Amount) >= 400 )  ",sqlObj={key:j,query:"LARGE donors SECOND FY before selected",sql:i},g.push(sqlObj),j="p1",i="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+r+" AND CloseDate < ="+s+" GROUP BY AccountId HAVING (  SUM(Amount) >= 1000 )  ",sqlObj={key:j,query:"Major",sql:i},g.push(sqlObj),j="p2",i="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+t+" AND CloseDate < ="+u+" GROUP BY AccountId HAVING (  SUM(Amount) >= 1000 )  ",sqlObj={key:j,query:"MAJOR donors Selected YTD -1",sql:i},g.push(sqlObj),j="p3",i="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+v+" AND CloseDate < ="+w+" GROUP BY AccountId HAVING (  SUM(Amount) >= 1000 )  ",sqlObj={key:j,query:"MAJOR donors Selected YTD -2",sql:i},g.push(sqlObj),j="p4",i="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+y+" AND CloseDate < ="+z+" GROUP BY AccountId HAVING (  SUM(Amount) >= 1000 )  ",sqlObj={key:j,query:"MAJOR donors first FY before selected",sql:i},g.push(sqlObj),j="p5",i="SELECT   COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+A+" AND CloseDate < ="+B+" GROUP BY AccountId HAVING (  SUM(Amount) >= 1000 )  ",sqlObj={key:j,query:"MAJOR donors SECOND FY before selected",sql:i},g.push(sqlObj),j="q1",i="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+r+" AND CloseDate < ="+s+" GROUP BY AccountId HAVING (  SUM(Amount) >= 0 )  ",sqlObj={key:j,query:"Total",sql:i},g.push(sqlObj),j="q2",i="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+t+" AND CloseDate < ="+u+" GROUP BY AccountId HAVING (  SUM(Amount) >= 0 )  ",sqlObj={key:j,query:"TOTAL donors Selected YTD -1",sql:i},g.push(sqlObj),j="q3",i="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+v+" AND CloseDate < ="+w+" GROUP BY AccountId HAVING (  SUM(Amount) >= 0 )  ",sqlObj={key:j,query:"TOTAL donors Selected YTD -2",sql:i},g.push(sqlObj),j="q4",i="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+y+" AND CloseDate < ="+z+" GROUP BY AccountId HAVING (  SUM(Amount) >= 0 )  ",sqlObj={key:j,query:"TOTAL donors first FY before selected",sql:i},g.push(sqlObj),j="q5",i="SELECT   COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+A+" AND CloseDate < ="+B+" GROUP BY AccountId HAVING (  SUM(Amount) >= 0 )  ",sqlObj={key:j,query:"TOTAL donors SECOND FY before selected",sql:i},g.push(sqlObj),G()},G=function(b){d.accessToken?(console.log("DID NOT reauthroize"),H()):(console.log("I want to do a check in getSalesforce to see if I need to auth. ",d.accessToken),a.get("/salesforce/force").then(function(a){d.response=a.data,d.accessToken=a.data.accessToken,d.instanceUrl=a.data.instanceUrl,H()}))},H=function(b){return b&&(f.push(b.data),h=f.length,f.length==g.length)?(console.log("Hey! In fetchForce in queryService, I think we are done!"),e.arrResults=f,I(),console.log(e),void L(e.arrResults)):void a.get("/salesforce/fetch",{params:{accessToken:d.accessToken,instanceUrl:d.instanceUrl,key:g[h].key,strSql:g[h].sql,queryInfo:g[h].query}}).then(function(a){H(a)})},I=function(){var a=(K("m1"),K("m2"),K("m3"),K("m4"),K("m5"),K("n1"),K("n2"),K("n3"),K("n4"),K("n5"),K("o1"),K("o2"),K("o3"),K("o4"),K("o5"),K("p1"),K("p2"),K("p3"),K("p4"),K("p5"),J("m1")),b=J("m2"),c=J("m3"),d=J("m4"),e=J("m5");m={type:"Base",ytd:a,ytdM1:b,ytdM2:c,tfyM1:d,tfyM2:e},l[0]=m;var f=J("n1"),g=J("n2"),h=J("n3"),i=J("n4"),j=J("n5");n={type:"Intermediate",ytd:f,ytdM1:g,ytdM2:h,tfyM1:i,tfyM2:j},l[1]=n;var k=J("o1"),r=J("o2"),s=J("o3"),t=J("o4"),u=J("o5");o={type:"Large",ytd:k,ytdM1:r,ytdM2:s,tfyM1:t,tfyM2:u},l[2]=o;var v=J("p1"),w=J("p2"),x=J("p3"),y=J("p4"),z=J("p5");p={type:"Major",ytd:v,ytdM1:w,ytdM2:x,tfyM1:y,tfyM2:z},l[3]=p;var A=J("q1"),B=J("q2"),C=J("q3"),D=J("q4"),E=J("q5");q={type:"Total",ytd:A,ytdM1:B,ytdM2:C,tfyM1:D,tfyM2:E},l[4]=q,console.log(l)},J=function(a){for(var b=0;b<f.length;b++)if(f[b].myKey==a){var c=f[b].result.records,d=0;for(x=0;x<c.length;x++)d+=c[x].expr1;return d}},K=function(a){for(var b=0,c=0;c<f.length;c++)f[c].myKey==a&&(b=f[c].count);return b},L=function(a){f=[],g=[],Sqlobj={},h=0,j="",i="",console.log("hit sort results",a);for(var c=0,d=0;d<a.length;d+=5){var e={};e=new b(a[d].queryInfo,a[d].count,a[d+1].count,a[d+2].count,a[d+3].count,a[d+4].count),console.log(e),k[c]=e,console.log(k),c++}console.log("did this actually work?!?!?",k)};return{getSalesforce:G,giftRange:F,data:c,forceData:e,forceresponse:d,arrResults:f,fetchForce:H,giftArray:k,amountRaised:l,setEndDate:D,endDate:C}}]),myApp.factory("GoalService",["$http",function(a){var b=[],c=function(b){console.log("*@FACTORY goalService, newGoals(addGoals): ",b),a.post("/goals/postgoals",b).then(function(a){console.log("@GoalService in newGoals function after post - response: ",a)})},d=function(){return a.get("/goals/getgoals").then(function(a){return console.log("@GoalService in getGoals() - response from server: ",a),b=a.data,console.log("!-@GoalService in getGoals() - goalsArray: ",b),a.data})},e=new Date;e=e.getFullYear();var f=e,g=2010,h=f+2,i=h,j=[],k=function(){for(var a=h;i>=g;)j.push(a),a--,i--},l=function(b){return console.log("<><> GET @goalService.js in getSpecificYear(year) - year: ",b),a.get("goals/"+b).then(function(a){return console.log("xxxxxxx @goalService.js - from server, response.data: ",a.data),a.data})},m=function(b){console.log("@FACTORY - updateGoals() before put - data: ",b),a.put("/goals/update",b).then(function(a){console.log("***@GoalService in updateGoals function after put - response: ",a)})};return{newGoals:c,getGoals:d,getSpecificYear:l,updateGoals:m,goalsArray:b,setYearList:k,currentYear:f,years:j}}]),myApp.factory("MoneyRaisedService",["$http",function(a){function b(a,b,c,d,e,f){this.type=a,this.ytd=b,this.ytdM1=c,this.ytdM2=d,this.tfyM1=e,this.tfyM2=f,this.goal=0,this.percentOfGoal=0,this.percentToGoal=0}var c={},d={},e={},f=[],g=[],h=0,i="",j="",k=[],l={},m=[],n=[],o=0,p={},q=new Date,r=new Date,s=new Date,t=new Date,u=new Date,v=new Date,w=new Date,x=new Date,y=new Date,z=new Date,A={};A.date=new Date;var B={},C=function(a){A.date=a,D(A),E(),F()},D=function(a){console.log("enddate object in set dates",a),date=a.date;var b=new Date(date);console.log("date in query",b),r=new Date(b),q=new Date("09/01/"+b.getFullYear()),q>r&&(q=new Date("09/01/"+(b.getFullYear()-1))),s=new Date(q),s.add({years:-1}),u=new Date(q),u.add({years:-2}),t=new Date(r),t.add({years:-1}),v=new Date(r),v.add({years:-2}),x=new Date("08/31/"+b.getFullYear()),x>b&&(x=new Date("08/31/"+(b.getFullYear()-1))),z=new Date(x),z.add({years:-1}),w=new Date(s),y=new Date(u),b=b.toFormat("YYYY-MM-DD"),q=q.toFormat("YYYY-MM-DD"),r=r.toFormat("YYYY-MM-DD"),s=s.toFormat("YYYY-MM-DD"),t=t.toFormat("YYYY-MM-DD"),u=u.toFormat("YYYY-MM-DD"),v=v.toFormat("YYYY-MM-DD"),w=w.toFormat("YYYY-MM-DD"),x=x.toFormat("YYYY-MM-DD"),y=y.toFormat("YYYY-MM-DD"),z=z.toFormat("YYYY-MM-DD")};D(A);var E=function(){i="a1",j="SELECT Donation_SubCategory__c, SUM(Amount) FROM  Opportunity WHERE StageName = 'Posted' AND Amount != null AND CloseDate >= "+q+" AND CloseDate <="+r+"  GROUP BY Donation_SubCategory__c ",sqlObj={key:i,query:"money raised YTD START AND END RATE this is NEW SPARTA",sql:j},g.push(sqlObj),i="a2",j="SELECT Donation_SubCategory__c, SUM(Amount) FROM  Opportunity WHERE StageName = 'Posted' AND Amount != null AND CloseDate >= "+s+" AND CloseDate <="+t+"  GROUP BY Donation_SubCategory__c ",sqlObj={key:i,query:"year -1 money raised YTD START AND END RATE this is NEW SPARTA",sql:j},g.push(sqlObj),i="a3",j="SELECT Donation_SubCategory__c, SUM(Amount) FROM  Opportunity WHERE StageName = 'Posted' AND Amount != null AND CloseDate >= "+u+" AND CloseDate <="+v+"  GROUP BY Donation_SubCategory__c ",sqlObj={key:i,query:"year -2 money raised YTD START AND END RATE this is NEW SPARTA",sql:j},g.push(sqlObj),i="a4",j="SELECT Donation_SubCategory__c, SUM(Amount) FROM  Opportunity WHERE StageName = 'Posted' AND Amount != null AND CloseDate >= "+w+" AND CloseDate <="+x+"  GROUP BY Donation_SubCategory__c ",sqlObj={key:i,query:"First Fiscal YEar before select date",sql:j},g.push(sqlObj),i="a5",j="SELECT Donation_SubCategory__c, SUM(Amount) FROM  Opportunity WHERE StageName = 'Posted' AND Amount != null AND CloseDate >= "+y+" AND CloseDate <="+z+"  GROUP BY Donation_SubCategory__c ",sqlObj={key:i,query:"SECOND Fiscal YEar before select date",sql:j},g.push(sqlObj),I()},F=function(){i="b1",j="SELECT  SUM(Amount) FROM  Opportunity WHERE StageName = 'Posted' AND Amount != null AND CloseDate >= "+q+" AND CloseDate <="+r,sqlObj={key:i,query:"TOTAL amount for ytd selected",sql:j},m.push(sqlObj),i="b2",j="SELECT  SUM(Amount) FROM  Opportunity WHERE StageName = 'Posted' AND Amount != null AND CloseDate >= "+s+" AND CloseDate <="+t,sqlObj={key:i,query:"TOTAL amount for ytd selected -1",sql:j},m.push(sqlObj),i="b3",j="SELECT  SUM(Amount) FROM  Opportunity WHERE StageName = 'Posted' AND Amount != null AND CloseDate >= "+u+" AND CloseDate <="+v,sqlObj={key:i,query:"TOTAL amount for ytd selected -2",sql:j},m.push(sqlObj),i="b4",j="SELECT  SUM(Amount) FROM  Opportunity WHERE StageName = 'Posted' AND Amount != null AND CloseDate >= "+w+" AND CloseDate <="+x,sqlObj={key:i,query:"TOTAL amount for First full fiscal year before selected",sql:j},m.push(sqlObj),i="b5",j="SELECT  SUM(Amount) FROM  Opportunity WHERE StageName = 'Posted' AND Amount != null AND CloseDate >= "+y+" AND CloseDate <="+z,sqlObj={key:i,query:"TOTAL amount for Second full fiscal year before selected",sql:j},m.push(sqlObj),G()},G=function(b){d.accessToken?(console.log("DID NOT reauthroize"),H()):a.get("/salesforce/force").then(function(a){d.response=a.data,d.accessToken=a.data.accessToken,d.instanceUrl=a.data.instanceUrl,H()})},H=function(b){return b&&(n.push(b.data),o=n.length,n.length==m.length)?(p.totalarrResults=n,void Q()):void a.get("/salesforce/fetch",{params:{accessToken:d.accessToken,instanceUrl:d.instanceUrl,key:m[o].key,strSql:m[o].sql,queryInfo:m[o].query}}).then(function(a){H(a)})},I=function(b){d.accessToken?(console.log("DID NOT reauthroize"),J()):a.get("/salesforce/force").then(function(a){d.response=a.data,d.accessToken=a.data.accessToken,d.instanceUrl=a.data.instanceUrl,J()})},J=function(b){return b&&(f.push(b.data),h=f.length,f.length==g.length)?(e.arrResults=f,L(A),void K(f)):void a.get("/salesforce/fetch",{params:{accessToken:d.accessToken,instanceUrl:d.instanceUrl,key:g[h].key,strSql:g[h].sql,queryInfo:g[h].query}}).then(function(a){J(a)})},K=function(a){f=[],g=[],Sqlobj={},h=0,i="",j="";var c={};c.total=[];for(var d=0;d<a.length;d++)for(var e=0;e<a[d].result.records.length;e++)null===a[d].result.records[e].Donation_SubCategory__c&&a[d].result.records.splice(e,1);for(var l=0;l<a[0].result.records.length;l++)c.type=a[0].result.records[l].Donation_SubCategory__c,c.total[0]=a[0].result.records[l].expr0,c.total[1]=a[1].result.records[l].expr0,c.total[2]=a[2].result.records[l].expr0,c.total[3]=a[3].result.records[l].expr0,c.total[4]=a[4].result.records[l].expr0,k[l]=new b(c.type,c.total[0],c.total[1],c.total[2],c.total[3],c.total[4]);console.log("did this actually work?!?!?",k)},L=function(b){var c=b.date;c=new Date(c),console.log("date in get goals",c);var d=c.getMonth(),e=new Date;e=8>d?c.getFullYear():c.getFullYear()+1,console.log("year in goals get call",e),a.get("/goals/getYear/"+e).then(function(a){l.object=a.data,M()})},M=function(){k[0].goal=l.object[0].yearly_totals.staff_year,k[1].goal=l.object[0].yearly_totals.board_year,k[2].goal=l.object[0].yearly_totals.committee_year,k[3].goal=l.object[0].yearly_totals.parent_year,k[4].goal=l.object[0].yearly_totals.alum_year,k[5].goal=l.object[0].yearly_totals.participant_year,k[6].goal=l.object[0].yearly_totals.community_year,k[7].goal=l.object[0].yearly_totals.corporate_organization_year,k[8].goal=l.object[0].yearly_totals.corporate_match_year,k[9].goal=l.object[0].yearly_totals.corporate_foundation_year,k[10].goal=l.object[0].yearly_totals.family_foundation_year,k[11].goal=l.object[0].yearly_totals.general_foundation_year,P(),N(k),O(k)},N=function(a){for(var b=0;b<a.length;b++){var c=a[b].ytd,d=a[b].goal,e=c/d;e=100*e,e=Math.round(e),a[b].percentToGoal=e}},O=function(a){var b=p.totalarrResults[0].result.records[0].expr0;b=Math.round(b);for(var c=0,d=0;d<a.length;d++){c=a[d].ytd;var e=c/b;e=100*e,e=Math.round(e),a[d].percentOfGoal=e}R()},P=function(){B={type:"Totals",ytd:p.totalarrResults[0].result.records[0].expr0,ytdM1:p.totalarrResults[1].result.records[0].expr0,ytdM2:p.totalarrResults[2].result.records[0].expr0,tfyM1:p.totalarrResults[3].result.records[0].expr0,tfyM2:p.totalarrResults[4].result.records[0].expr0,goal:l.object[0].yearly_totals.year_total,percentOfGoal:0,percentToGoal:0};var a=k.length;a>=12&&(a=12),k[a]=B},Q=function(){B={type:"Totals",ytd:p.totalarrResults[0].result.records[0].expr0,ytdM1:p.totalarrResults[1].result.records[0].expr0,ytdM2:p.totalarrResults[2].result.records[0].expr0,tfyM1:p.totalarrResults[3].result.records[0].expr0,tfyM2:p.totalarrResults[4].result.records[0].expr0,goal:l.object[0].yearly_totals.year_total,percentOfGoal:0,percentToGoal:0};var a=k.length;a>=12&&(a=12),k[a]=B,N(k),O(k)},R=function(){n=[],m=[],o=0};return{getSalesforce:I,moneyRaised:E,data:c,forceData:e,forceresponse:d,arrResults:f,fetchForce:J,accountArray:k,getTotals:F,setEndDate:C,endDate:A}}]),myApp.factory("QueryService",["$http",function(a){var b={},c={},d={},e=[],f=[],g=0,h="",i=new Date("12-31-2015"),j=new Date,k=new Date,l=new Date,m=new Date,n=new Date,o=new Date,p=new Date,q=new Date,r=new Date,s=new Date,t=new Date,u=new Date,v=new Date,w=new Date,y=new Date,z=new Date,A=new Date,B=new Date,C=new Date;k=new Date(i),j=new Date("09/01/"+i.getFullYear()),j>k&&(j=new Date("09/01/"+(i.getFullYear()-1))),l=new Date(j),l.add({years:-1}),n=new Date(j),n.add({years:-2}),p=new Date(j),p.add({years:-3}),r=new Date(j),r.add({years:-4}),m=new Date(k),m.add({years:-1}),o=new Date(k),o.add({years:-2}),q=new Date(k),q.add({years:-3}),s=new Date(k),s.add({years:-4}),u=new Date("08/31/"+i.getFullYear()),u>i&&(u=new Date("08/31/"+(i.getFullYear()-1))),w=new Date(u),w.add({years:-1}),z=new Date(u),z.add({years:-2}),B=new Date(u),B.add({years:-3}),C=new Date(u),C.add({years:-4}),t=new Date(l),v=new Date(n),y=new Date(p),A=new Date(r),i=i.toFormat("YYYY-MM-DD"),j=j.toFormat("YYYY-MM-DD"),k=k.toFormat("YYYY-MM-DD"),l=l.toFormat("YYYY-MM-DD"),m=m.toFormat("YYYY-MM-DD"),n=n.toFormat("YYYY-MM-DD"),o=o.toFormat("YYYY-MM-DD"),p=p.toFormat("YYYY-MM-DD"),q=q.toFormat("YYYY-MM-DD"),r=r.toFormat("YYYY-MM-DD"),s=s.toFormat("YYYY-MM-DD"),t=t.toFormat("YYYY-MM-DD"),u=u.toFormat("YYYY-MM-DD"),v=v.toFormat("YYYY-MM-DD"),w=w.toFormat("YYYY-MM-DD"),y=y.toFormat("YYYY-MM-DD"),z=z.toFormat("YYYY-MM-DD"),A=A.toFormat("YYYY-MM-DD"),B=B.toFormat("YYYY-MM-DD"),C=C.toFormat("YYYY-MM-DD"),console.log("selEndDate",i),console.log("ytdStart",j),console.log("ytdEnd",k),console.log("ytdM1Start",l),console.log("ytdM1End",m),console.log("ytdM2Start",n),console.log("ytdM2End",o),console.log("ytdM3Start",p),console.log("ytdM3End",q),console.log("ytdM4Start",r),console.log("ytdM4End",s),console.log("fyM1Start",t),console.log("fyM1End",u),console.log("fyM2Start",v),console.log("fyM2End",w),console.log("fyM3Start",y),console.log("fyM3End",z),console.log("fyM4Start",A),console.log("fyM4End",B),console.log("fyM5End",C);var D="";D="a1",h="SELECT Donation_SubCategory__c, SUM(Amount) FROM  Opportunity WHERE StageName = 'Posted' AND Amount != null AND CloseDate >= "+j+" AND CloseDate <="+k+"  GROUP BY Donation_SubCategory__c ",sqlObj={key:D,query:"money raised YTD START AND END RATE this is NEW SPARTA",sql:h},f.push(sqlObj),D="a2",h="SELECT Donation_SubCategory__c, SUM(Amount) FROM  Opportunity WHERE StageName = 'Posted' AND Amount != null AND CloseDate >= "+l+" AND CloseDate <="+m+"  GROUP BY Donation_SubCategory__c ",sqlObj={key:D,query:"year -1 money raised YTD START AND END RATE this is NEW SPARTA",sql:h},f.push(sqlObj),D="a3",h="SELECT Donation_SubCategory__c, SUM(Amount) FROM  Opportunity WHERE StageName = 'Posted' AND Amount != null AND CloseDate >= "+n+" AND CloseDate <="+o+"  GROUP BY Donation_SubCategory__c ",sqlObj={key:D,query:"year -2 money raised YTD START AND END RATE this is NEW SPARTA",sql:h},f.push(sqlObj),D="a4",h="SELECT Donation_SubCategory__c, SUM(Amount) FROM  Opportunity WHERE StageName = 'Posted' AND Amount != null AND CloseDate >= "+t+" AND CloseDate <="+u+"  GROUP BY Donation_SubCategory__c ",sqlObj={key:D,query:"First Fiscal YEar before select date",sql:h},f.push(sqlObj),D="a5",h="SELECT Donation_SubCategory__c, SUM(Amount) FROM  Opportunity WHERE StageName = 'Posted' AND Amount != null AND CloseDate >= "+v+" AND CloseDate <="+w+"  GROUP BY Donation_SubCategory__c ",sqlObj={key:D,query:"SECOND Fiscal YEar before select date",sql:h},f.push(sqlObj),D="b1",h="SELECT  SUM(Amount) FROM  Opportunity WHERE StageName = 'Posted' AND Amount != null AND CloseDate >= "+j+" AND CloseDate <="+k,sqlObj={key:D,query:"TOTAL amount for ytd selected",sql:h},f.push(sqlObj),D="b2",h="SELECT  SUM(Amount) FROM  Opportunity WHERE StageName = 'Posted' AND Amount != null AND CloseDate >= "+l+" AND CloseDate <="+m,sqlObj={key:D,query:"TOTAL amount for ytd selected -1",sql:h},f.push(sqlObj),D="b3",h="SELECT  SUM(Amount) FROM  Opportunity WHERE StageName = 'Posted' AND Amount != null AND CloseDate >= "+n+" AND CloseDate <="+o,sqlObj={key:D,query:"TOTAL amount for ytd selected -2",sql:h},f.push(sqlObj),D="b4",h="SELECT  SUM(Amount) FROM  Opportunity WHERE StageName = 'Posted' AND Amount != null AND CloseDate >= "+t+" AND CloseDate <="+u,sqlObj={key:D,query:"TOTAL amount for First full fiscal year before selected",sql:h},f.push(sqlObj),D="b5",h="SELECT  SUM(Amount) FROM  Opportunity WHERE StageName = 'Posted' AND Amount != null AND CloseDate >= "+v+" AND CloseDate <="+w,sqlObj={key:D,query:"TOTAL amount for Second full fiscal year before selected",sql:h},f.push(sqlObj),D="c1",h="SELECT  COUNT(Id) FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' GROUP BY AccountId HAVING MIN(CloseDate) >= "+j+" AND MIN(CloseDate) <= "+k,sqlObj={key:D,query:"first time donors  YTD SELECTED",sql:h},f.push(sqlObj),D="c2",h="SELECT  COUNT(Id) FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' GROUP BY AccountId HAVING MIN(CloseDate) >= "+l+" AND MIN(CloseDate) <= "+m,sqlObj={key:D,query:"first time donors  YTD SELECTED -1",sql:h},f.push(sqlObj),D="c3",h="SELECT  COUNT(Id) FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' GROUP BY AccountId HAVING MIN(CloseDate) >= "+n+" AND MIN(CloseDate) <= "+o,sqlObj={key:D,query:"first time donors  YTD SELECTED -2",sql:h},f.push(sqlObj),D="c4",h="SELECT  COUNT(Id) FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' GROUP BY AccountId HAVING MIN(CloseDate) >= "+t+" AND MIN(CloseDate) <= "+u,sqlObj={key:D,query:"first time donors  First FY before selected",sql:h},f.push(sqlObj),D="c5",h="SELECT  COUNT(Id) FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' GROUP BY AccountId HAVING MIN(CloseDate) >= "+v+" AND MIN(CloseDate) <= "+w,sqlObj={key:D,query:"first time donors  Second FY before selected",sql:h},f.push(sqlObj),D="m1",h="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate >="+j+" AND CloseDate < ="+k+" GROUP BY AccountId HAVING ( SUM(Amount) <= 95 )  ",sqlObj={key:D,query:"BASE donors Selected YTD",sql:h},f.push(sqlObj),D="m2",h="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate >= "+l+" AND CloseDate < ="+m+" GROUP BY AccountId HAVING ( SUM(Amount) <= 95  )  ",sqlObj={key:D,query:"BASE donors Selected YTD -1",sql:h},f.push(sqlObj),D="m3",h="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+n+" AND CloseDate < ="+o+" GROUP BY AccountId HAVING ( SUM(Amount) <= 95 )  ",sqlObj={key:D,query:"BASE donors Selected YTD -2",sql:h},f.push(sqlObj),D="m4",h="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+t+" AND CloseDate < ="+u+" GROUP BY AccountId HAVING ( SUM(Amount) <= 95 )  ",sqlObj={key:D,query:"BASE donors first FY before selected",sql:h},f.push(sqlObj),D="m5",h="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+v+" AND CloseDate < ="+w+" GROUP BY AccountId HAVING ( SUM(Amount) <= 95 )  ",sqlObj={key:D,query:"BASE donors SECOND FY before selected",sql:h},f.push(sqlObj),D="n1",h="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+j+" AND CloseDate < ="+k+" GROUP BY AccountId HAVING ( SUM(Amount) < 400 AND SUM(Amount) > 95 )  ",sqlObj={key:D,query:"INTERMEDIATE donors Selected YTD",sql:h},f.push(sqlObj),D="n2",h="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+l+" AND CloseDate < ="+m+" GROUP BY AccountId HAVING ( SUM(Amount) < 400 AND SUM(Amount) > 95 )  ",sqlObj={key:D,query:"INTERMEDIATE donors Selected YTD -1",sql:h},f.push(sqlObj),D="n3",h="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+n+" AND CloseDate < ="+o+" GROUP BY AccountId HAVING ( SUM(Amount) < 400 AND SUM(Amount) > 95 )  ",sqlObj={key:D,query:"INTERMEDIATE donors Selected YTD -2",sql:h},f.push(sqlObj),D="n4",h="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+t+" AND CloseDate < ="+u+" GROUP BY AccountId HAVING ( SUM(Amount) < 400 AND SUM(Amount) > 95 ) ",sqlObj={key:D,query:"INTERMEDIATE donors first FY before selected",sql:h},f.push(sqlObj),D="n5",h="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+v+" AND CloseDate < ="+w+" GROUP BY AccountId HAVING ( SUM(Amount) < 400 AND SUM(Amount) > 95 )  ",sqlObj={key:D,query:"INTERMEDIATE donors SECOND FY before selected",sql:h},f.push(sqlObj),D="o1",h="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+j+" AND CloseDate < ="+k+" GROUP BY AccountId HAVING ( SUM(Amount) < 1000 AND SUM(Amount) >= 400 )  ",sqlObj={key:D,query:"LARGE donors Selected YTD",sql:h},f.push(sqlObj),D="o2",h="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+l+" AND CloseDate < ="+m+" GROUP BY AccountId HAVING ( SUM(Amount) < 1000 AND SUM(Amount) >= 400 )  ",sqlObj={key:D,query:"LARGE donors Selected YTD -1",sql:h},f.push(sqlObj),D="o3",h="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+n+" AND CloseDate < ="+o+" GROUP BY AccountId HAVING ( SUM(Amount) < 1000 AND SUM(Amount) >= 400 )  ",sqlObj={key:D,query:"LARGE donors Selected YTD -2",sql:h},f.push(sqlObj),D="o4",h="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+t+" AND CloseDate < ="+u+" GROUP BY AccountId HAVING ( SUM(Amount) < 1000 AND SUM(Amount) >= 400 ) ",sqlObj={key:D,query:"LARGE donors first FY before selected",sql:h},f.push(sqlObj),D="o5",h="SELECT   COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+v+" AND CloseDate < ="+w+" GROUP BY AccountId HAVING ( SUM(Amount) < 1000 AND SUM(Amount) >= 400 )  ",sqlObj={key:D,query:"LARGE donors SECOND FY before selected",sql:h},f.push(sqlObj),D="p1",h="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+j+" AND CloseDate < ="+k+" GROUP BY AccountId HAVING (  SUM(Amount) >= 1000 )  ",sqlObj={key:D,query:"MAJOR donors Selected YTD",sql:h},f.push(sqlObj),D="p2",h="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+l+" AND CloseDate < ="+m+" GROUP BY AccountId HAVING (  SUM(Amount) >= 1000 )  ",sqlObj={key:D,query:"MAJOR donors Selected YTD -1",sql:h},f.push(sqlObj),D="p3",h="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+n+" AND CloseDate < ="+o+" GROUP BY AccountId HAVING (  SUM(Amount) >= 1000 )  ",sqlObj={key:D,query:"MAJOR donors Selected YTD -2",sql:h},f.push(sqlObj),D="p4",h="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+t+" AND CloseDate < ="+u+" GROUP BY AccountId HAVING (  SUM(Amount) >= 1000 )  ",sqlObj={key:D,query:"MAJOR donors first FY before selected",sql:h},f.push(sqlObj),D="p5",h="SELECT   COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+v+" AND CloseDate < ="+w+" GROUP BY AccountId HAVING (  SUM(Amount) >= 1000 )  ",sqlObj={key:D,query:"MAJOR donors SECOND FY before selected",sql:h},f.push(sqlObj),D="q1",h="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+j+" AND CloseDate < ="+k+" GROUP BY AccountId HAVING (  SUM(Amount) >= 0 )  ",sqlObj={key:D,query:"TOTAL donors Selected YTD",sql:h},f.push(sqlObj),D="q2",h="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+l+" AND CloseDate < ="+m+" GROUP BY AccountId HAVING (  SUM(Amount) >= 0 )  ",sqlObj={key:D,query:"TOTAL donors Selected YTD -1",sql:h},f.push(sqlObj),D="q3",h="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+n+" AND CloseDate < ="+o+" GROUP BY AccountId HAVING (  SUM(Amount) >= 0 )  ",sqlObj={key:D,query:"TOTAL donors Selected YTD -2",sql:h},f.push(sqlObj),D="q4",h="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+t+" AND CloseDate < ="+u+" GROUP BY AccountId HAVING (  SUM(Amount) >= 0 )  ",sqlObj={key:D,query:"TOTAL donors first FY before selected",sql:h},f.push(sqlObj),D="q5",h="SELECT   COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+v+" AND CloseDate < ="+w+" GROUP BY AccountId HAVING (  SUM(Amount) >= 0 )  ",sqlObj={key:D,query:"TOTAL donors SECOND FY before selected",sql:h},f.push(sqlObj),D="d1",h="SELECT Id, Name FROM Account WHERE Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate >= "+j+" AND CloseDate < ="+k+")",h+="AND  Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate > ="+v+" AND CloseDate < ="+u+") ",sqlObj={key:D,query:"CURRENT RETAINED YTD new def",sql:h},f.push(sqlObj),D="d2",h="SELECT Id, Name FROM Account WHERE Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate >= "+l+" AND CloseDate <= "+m+")",h+="AND  Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate >= "+y+" AND CloseDate <= "+w+") ",sqlObj={key:D,query:"CURRENT RETAINED YTD-1 new def",sql:h},f.push(sqlObj),D="d3",h="SELECT Id, Name FROM Account WHERE Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate >= "+n+" AND CloseDate <= "+o+")",
h+="AND  Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate >= "+A+" AND CloseDate <= "+z+") ",sqlObj={key:D,query:"CURRENT RETAINED YTD-2 new def",sql:h},f.push(sqlObj),D="d4",h="SELECT Id, Name FROM Account WHERE Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate >= "+t+" AND CloseDate <= "+u+")",h+="AND  Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate > ="+y+" AND CloseDate <= "+w+") ",sqlObj={key:D,query:"CURRENT RETAINED FYM1",sql:h},f.push(sqlObj),D="d5",h="SELECT Id, Name FROM Account WHERE Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate >= "+v+" AND CloseDate <= "+w+")",h+="AND  Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate > ="+A+" AND CloseDate <= "+z+") ",sqlObj={key:D,query:"CURRENT RETAINED FYM2",sql:h},f.push(sqlObj),D="e1",h="SELECT Id, Name FROM Account WHERE Id NOT IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate >= "+j+" AND CloseDate <= "+k+")",h+="AND  Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate >= "+v+" AND CloseDate < ="+u+") ",sqlObj={key:D,query:"l2ybnty YTD new def",sql:h},f.push(sqlObj),D="e2",h="SELECT Id, Name FROM Account WHERE Id NOT IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate >= "+l+" AND CloseDate <= "+m+")",h+="AND  Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate >= "+y+" AND CloseDate <= "+w+") ",sqlObj={key:D,query:"l2ybnty YTD-1 new def",sql:h},f.push(sqlObj),D="e3",h="SELECT Id, Name FROM Account WHERE Id NOT IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate >= "+n+" AND CloseDate <= "+o+")",h+="AND  Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate >= "+A+" AND CloseDate <= "+z+") ",sqlObj={key:D,query:"l2ybnty YTD-2 new def",sql:h},f.push(sqlObj),D="e4",h="SELECT Id, Name FROM Account WHERE Id NOT IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate >= "+t+" AND CloseDate <= "+u+")",h+="AND  Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate >= "+y+" AND CloseDate <= "+w+") ",sqlObj={key:D,query:"l2ybnty FYM1",sql:h},f.push(sqlObj),D="e5",h="SELECT Id, Name FROM Account WHERE Id NOT IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate >= "+v+" AND CloseDate <= "+w+")",h+="AND  Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate >= "+A+" AND CloseDate <= "+z+") ",sqlObj={key:D,query:"l2ybnty FYM2",sql:h},f.push(sqlObj),D="f1a",h="SELECT Id, Name FROM Account WHERE Id  IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate > "+j+" AND CloseDate < "+k+")",h+="AND  Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate < "+z+") ",sqlObj={key:D,query:"donated in sel yetd, AND  sometime prior to the previous two fiscal years",sql:h},f.push(sqlObj),D="f1b",h="SELECT Id, Name FROM Account WHERE Id  IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate > "+v+" AND CloseDate < "+u+")",sqlObj={key:D,query:"donated in the previous 2 fiscal years",sql:h},f.push(sqlObj),D="f2a",h="SELECT Id, Name FROM Account WHERE Id  IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate > "+l+" AND CloseDate < "+m+")",h+="AND  Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate < "+B+") ",sqlObj={key:D,query:"donated in sel yetd-1, AND  sometime prior to the previous two fiscal years",sql:h},f.push(sqlObj),D="f2b",h="SELECT Id, Name FROM Account WHERE Id  IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate > "+y+" AND CloseDate < "+w+")",sqlObj={key:D,query:"donated in the previous 2 fiscal years",sql:h},f.push(sqlObj),D="f3a",h="SELECT Id, Name FROM Account WHERE Id  IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate > "+n+" AND CloseDate < "+o+")",h+="AND  Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate < "+C+") ",sqlObj={key:D,query:"donated in sel yetd-1, AND  sometime prior to the previous two fiscal years",sql:h},f.push(sqlObj),D="f3b",h="SELECT Id, Name FROM Account WHERE Id  IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate > "+A+" AND CloseDate < "+z+")",sqlObj={key:D,query:"donated in the previous 2 fiscal years",sql:h},f.push(sqlObj),D="f4a",h="SELECT Id, Name FROM Account WHERE Id  IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate > "+t+" AND CloseDate < "+u+")",h+="AND  Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate < "+y+") ",sqlObj={key:D,query:"donated in sel yetd-1, AND  sometime prior to the previous two fiscal years",sql:h},f.push(sqlObj),D="f5a",h="SELECT Id, Name FROM Account WHERE Id  IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate > "+v+" AND CloseDate < "+w+")",h+="AND  Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate < "+A+") ",sqlObj={key:D,query:"donated in sel yetd-1, AND  sometime prior to the previous two fiscal years",sql:h},f.push(sqlObj),D="g1",h="SELECT AccountId,  COUNT(Id) FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' GROUP BY AccountId HAVING MAX(CloseDate) <= "+z,sqlObj={key:D,query:"lost ytd (how is this yeartd)",sql:h},f.push(sqlObj),D="g2",h="SELECT  COUNT(Id) FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' GROUP BY AccountId HAVING MAX(CloseDate) <= "+B,sqlObj={key:D,query:"lost ytd-1 (how is this yeartd)",sql:h},f.push(sqlObj),D="g3",h="SELECT  COUNT(Id) FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' GROUP BY AccountId HAVING MAX(CloseDate) <= "+C,sqlObj={key:D,query:"lost ytd-2 (how is this yeartd)",sql:h},f.push(sqlObj),D="h1",h="SELECT  SUM(Amount) TotalCash FROM  Opportunity WHERE Donation_SubCategory__c IN ('Staff',  'Board','Committee','Parent', 'Alum','Participant','Community Support')   AND StageName = 'Posted' AND Amount != null AND CloseDate >= "+j+" AND CloseDate <="+k,sqlObj={key:D,query:"TOTAL amount individuals YTD",sql:h},f.push(sqlObj),D="h2",h="SELECT  SUM(Amount) TotalCash FROM  Opportunity WHERE Donation_SubCategory__c IN ('Staff',  'Board','Committee','Parent', 'Alum','Participant','Community Support')   AND StageName = 'Posted' AND Amount != null AND CloseDate >= "+l+" AND CloseDate <="+m,sqlObj={key:D,query:"TOTAL amount individuals YTDm1",sql:h},f.push(sqlObj),D="h3",h="SELECT  SUM(Amount) TotalCash FROM  Opportunity WHERE Donation_SubCategory__c IN ('Staff',  'Board','Committee','Parent', 'Alum','Participant','Community Support')   AND StageName = 'Posted' AND Amount != null AND CloseDate >= "+n+" AND CloseDate <="+o,sqlObj={key:D,query:"TOTAL amount individuals YTDm2",sql:h},f.push(sqlObj),D="h4",h="SELECT  SUM(Amount) TotalCash FROM  Opportunity WHERE Donation_SubCategory__c IN ('Staff',  'Board','Committee','Parent', 'Alum','Participant','Community Support')   AND StageName = 'Posted' AND Amount != null AND CloseDate >= "+t+" AND CloseDate <="+u,sqlObj={key:D,query:"TOTAL amount individuals Fym1",sql:h},f.push(sqlObj),D="h5",h="SELECT  SUM(Amount) TotalCash FROM  Opportunity WHERE Donation_SubCategory__c IN ('Staff',  'Board','Committee','Parent', 'Alum','Participant','Community Support')   AND StageName = 'Posted' AND Amount != null AND CloseDate >= "+v+" AND CloseDate <="+w,sqlObj={key:D,query:"TOTAL amount individuals Fym2",sql:h},f.push(sqlObj),D="i1",h="SELECT  SUM(Amount) TotalCash FROM  Opportunity WHERE Donation_SubCategory__c IN ('Corporate/Organization Money','Corporate Match')   AND StageName = 'Posted' AND Amount != null AND CloseDate >= "+j+" AND CloseDate <="+k,sqlObj={key:D,query:"TOTAL amount corporate YTD",sql:h},f.push(sqlObj),D="i2",h="SELECT  SUM(Amount) TotalCash FROM  Opportunity WHERE Donation_SubCategory__c IN ('Corporate/Organization Money','Corporate Match')   AND StageName = 'Posted' AND Amount != null AND CloseDate >= "+l+" AND CloseDate <="+m,sqlObj={key:D,query:"TOTAL amount corporate YTDm1",sql:h},f.push(sqlObj),D="i3",h="SELECT  SUM(Amount) TotalCash FROM  Opportunity WHERE Donation_SubCategory__c IN ('Corporate/Organization Money','Corporate Match')   AND StageName = 'Posted' AND Amount != null AND CloseDate >= "+n+" AND CloseDate <="+o,sqlObj={key:D,query:"TOTAL amount corporate YTDm2",sql:h},f.push(sqlObj),D="i4",h="SELECT  SUM(Amount) TotalCash FROM  Opportunity WHERE Donation_SubCategory__c IN ('Corporate/Organization Money','Corporate Match')   AND StageName = 'Posted' AND Amount != null AND CloseDate >= "+t+" AND CloseDate <="+u,sqlObj={key:D,query:"TOTAL amount corporate Fym1",sql:h},f.push(sqlObj),D="i5",h="SELECT  SUM(Amount) TotalCash FROM  Opportunity WHERE Donation_SubCategory__c IN ('Corporate/Organization Money','Corporate Match')   AND StageName = 'Posted' AND Amount != null AND CloseDate >= "+v+" AND CloseDate <="+w,sqlObj={key:D,query:"TOTAL amount corporate Fym2",sql:h},f.push(sqlObj),D="j1",h="SELECT  SUM(Amount) TotalCash FROM  Opportunity WHERE Donation_SubCategory__c IN ('Corporate Foundation','Family Foundation/Fund','General Foundation')   AND StageName = 'Posted' AND Amount != null AND CloseDate >= "+j+" AND CloseDate <="+k,sqlObj={key:D,query:"TOTAL amount foundation YTD",sql:h},f.push(sqlObj),D="j2",h="SELECT  SUM(Amount) TotalCash FROM  Opportunity WHERE Donation_SubCategory__c IN ('Corporate Foundation','Family Foundation/Fund','General Foundation')   AND StageName = 'Posted' AND Amount != null AND CloseDate >= "+l+" AND CloseDate <="+m,sqlObj={key:D,query:"TOTAL amount foundation YTDm1",sql:h},f.push(sqlObj),D="j3",h="SELECT  SUM(Amount) TotalCash FROM  Opportunity WHERE Donation_SubCategory__c IN ('Corporate Foundation','Family Foundation/Fund','General Foundation')   AND StageName = 'Posted' AND Amount != null AND CloseDate >= "+n+" AND CloseDate <="+o,sqlObj={key:D,query:"TOTAL amount foundation YTDm2",sql:h},f.push(sqlObj),D="j4",h="SELECT  SUM(Amount) TotalCash FROM  Opportunity WHERE Donation_SubCategory__c IN ('Corporate Foundation','Family Foundation/Fund','General Foundation')   AND StageName = 'Posted' AND Amount != null AND CloseDate >= "+t+" AND CloseDate <="+u,sqlObj={key:D,query:"TOTAL amount foundation Fym1",sql:h},f.push(sqlObj),D="j5",h="SELECT  SUM(Amount) TotalCash FROM  Opportunity WHERE Donation_SubCategory__c IN ('Corporate Foundation','Family Foundation/Fund','General Foundation')   AND StageName = 'Posted' AND Amount != null AND CloseDate >= "+v+" AND CloseDate <="+w,sqlObj={key:D,query:"TOTAL amount foundation Fym2",sql:h},f.push(sqlObj);var E=function(b){c.accessToken?(console.log("DID NOT reauthroize"),F()):(console.log("I want to do a check in getSalesforce to see if I need to auth. ",c.accessToken),a.get("/salesforce/force").then(function(a){c.response=a.data,c.accessToken=a.data.accessToken,c.instanceUrl=a.data.instanceUrl,F()}))},F=function(b){return console.log("in fetch force, forceResult=",b),b&&(e.push(b.data),g=e.length,console.log("sql index",g),e.length==f.length)?(console.log("Hey! In fetchForce in queryService, I think we are done!"),d.arrResults=e,void G()):(console.log("getting ready to get in fetch. sqlIndex=",g,"arrSql[sqlIndex]=",f[g].sql),void a.get("/salesforce/fetch",{params:{accessToken:c.accessToken,instanceUrl:c.instanceUrl,key:f[g].key,strSql:f[g].sql,queryInfo:f[g].query}}).then(function(a){F(a)}))},G=function(){console.log("Hey we are totally in parseResults"),console.log("Donor	Acquistion	&	Retention"),console.log("first time donors");var a=J("c1"),b=J("c2"),c=J("c3"),d=J("c4"),e=J("c5");console.log("ftdYTD",a),console.log("ftdYTDm1",b),console.log("ftdYTDm2",c),console.log("ftdFym1",d),console.log("ftdFym2",e),console.log("Current retained donors");var f=J("d1"),g=J("d2"),h=J("d3"),i=J("d4"),j=J("d5");console.log("crdSelYTD",f),console.log("crdSelYTDm1",g),console.log("crdSelYTDm1",h),console.log("crdFym1",i),console.log("crdFym2",j),console.log("L2YBNTY");var k=J("e1"),l=J("e2"),m=J("e3"),n=J("e4"),o=J("e5");console.log("l2ybntyYTD",k),console.log("l2ybntyYTDM1",l),console.log("l2ybntyYTDM2",m),console.log("l2ybntyFym1",n),console.log("l2ybntyFym2",o),console.log("Total current donor pool");var p=a+f+k,q=b+g+l,r=c+h+m,s=d+i+n,t=e+j+o;console.log("tcdpYTD",p),console.log("tcdpYTDm1",q),console.log("tcdpYTDm2",r),console.log("tcdpFym1",s),console.log("tcdpFym2",t),console.log("Current retained donors percentage");var u=f/p,v=g/q,w=h/r,x=i/s,y=j/t;console.log("pctCrdSelYTD",u),console.log("pctCrdSelYTDm1",v),console.log("pctCrdSelYTDm2",w),console.log("pctCrdFym1",x),console.log("pctCrdFym2",y),console.log("Recovered Donors");var z=I("f1a","f1b"),A=I("f2a","f2b"),B=I("f3a","f3b"),C=I("f4a","f2b"),D=I("f5a","f3b");console.log("recYTD",z),console.log("recYTDm1",A),console.log("recYTDm2",B),console.log("recFym1",C),console.log("recFym2",D),console.log("Lost Donors");var E=J("g1"),F=J("g2"),G=J("g3"),K=J("g1"),L=J("g2");console.log("lostYTD",E),console.log("lostYTDm1",F),console.log("lostYTDm2",G),console.log("lostFym1",K),console.log("lostFym2",L),console.log("Total lost recovery  pool");var M=z+E,N=A+F,O=B+G,P=C+K,Q=D+L;console.log("poolYTD",M),console.log("poolYTDm1",N),console.log("poolYTDm2",O),console.log("poolFym1",P),console.log("poolFym2",Q),console.log("Percentage donors recovered");var R=z/E,S=A/F,T=B/G,U=C/K,V=D/L;console.log("pctRecYTD",R),console.log("pctRecYTDm1",S),console.log("pctRecYTDm2",T),console.log("pctRecFym1",U),console.log("pctRecFym2",V),console.log("Donor Universe");var W=p+M,X=q+N,Y=r+O,Z=s+P,$=t+Q;console.log("duYTD",W),console.log("duYTDm1",X),console.log("duYTDm2",Y),console.log("duFym1",Z),console.log("duFym2",$),console.log("Percentage retained donors");var _=W/f,aa=X/g,ba=Y/h,ca=Z/i,da=$/j;console.log("prdYTD",_),console.log("prdYTDm1",aa),console.log("prdYTDm2",ba),console.log("prdFym1",ca),console.log("prdFym2",da),console.log("Gift Range Chart"),console.log("Donors at each level"),console.log("Base");var ea=J("m1"),fa=J("m2"),ga=J("m3"),ha=J("m4"),ia=J("m5");console.log("baseYTD",ea),console.log("baseYTDm1",fa),console.log("baseYTDm2",ga),console.log("baseFym1",ha),console.log("baseFym2",ia),console.log("Inter");var ja=J("n1"),ka=J("n2"),la=J("n3"),ma=J("n4"),na=J("n5");console.log("interYTD",ja),console.log("interYTDm1",ka),console.log("interYTDm2",la),console.log("interFym1",ma),console.log("interFym2",na),console.log("Large");var oa=J("o1"),pa=J("o2"),qa=J("o3"),ra=J("o4"),sa=J("o5");console.log("largeYTD",oa),console.log("largeYTDm1",pa),console.log("largeYTDm2",qa),console.log("largeFym1",ra),console.log("largeFym2",sa),console.log("Major");var ta=J("p1"),ua=J("p2"),va=J("p3"),wa=J("p4"),xa=J("p5");console.log("majorYTD",ta),console.log("majorYTDm1",ua),console.log("majorYTDm2",va),console.log("majorFym1",wa),console.log("majorFym2",xa),console.log("Total Donors");var ya=ea+ja+oa+ta,za=fa+ka+pa+ua,Aa=ga+la+qa+va,Ba=ha+ma+ra+wa,Ca=ia+na+sa+xa;console.log("totDonYTD",ya),console.log("totDonYTDm1",za),console.log("totDonYTDm2",Aa),console.log("totDonFym1",Ba),console.log("totDonFym2",Ca),console.log("gift range amounts"),console.log("Base");var Da=H("m1"),Ea=H("m2"),Fa=H("m3"),Ga=H("m4"),Ha=H("m5");console.log("totalBaseSelYTD =",Da),console.log("totalBaseSelYTDm1 =",Ea),console.log("totalBaseSelYTDm2 =",Fa),console.log("totalBaseFYm1 =",Ga),console.log("totalBaseFYm2 =",Ha),console.log("intermediate");var Ia=H("n1"),Ja=H("n2"),Ka=H("n3"),La=H("n4"),Ma=H("n5");console.log("totalInterSelYTD =",Ia),console.log("totalInterSelYTDm1 =",Ja),console.log("totalInterSelYTDm2 =",Ka),console.log("totalInterFYm1 =",La),console.log("totalInterFYm2 =",Ma),console.log("Large");var Na=H("o1"),Oa=H("o2"),Pa=H("o3"),Qa=H("o4"),Ra=H("o5");console.log("totalLargeSelYTD =",Na),console.log("totalLargeSelYTDm1 =",Oa),console.log("totalLargeSelYTDm2 =",Pa),console.log("totalLargeFYm1 =",Qa),console.log("totalLargeFYm2 =",Ra),console.log("major");var Sa=H("p1"),Ta=H("p2"),Ua=H("p3"),Va=H("p4"),Wa=H("p5");console.log("totalMajorSelYTD =",Sa),console.log("totalMajorSelYTDm1 =",Ta),console.log("totalMajorSelYTDm2 =",Ua),console.log("totalMajorFYm1 =",Va),console.log("totalMajorFYm2 =",Wa),console.log("Total");var Xa=H("q1"),Ya=H("q2"),Za=H("q3"),$a=H("q4"),_a=H("q5");console.log("totalAllSelYTD =",Xa),console.log("totalAllSelYTDm1 =",Ya),console.log("totalAllSelYTDm2 =",Za),console.log("totalAllFYm1 =",$a),console.log("totalAllFYm2 =",_a)},H=function(a){for(var b=0;b<e.length;b++)if(e[b].myKey==a){var c=e[b].result.records,d=0;for(x=0;x<c.length;x++)d+=c[x].expr1;return d}},I=function(a,b){for(var c=[],d=[],f=0;f<e.length;f++)e[f].myKey==a&&(c=e[f].result.records),e[f].myKey==b&&(d=e[f].result.records);for(f=0;f<d.length;f++)for(var g=0;g<c.length;g++)c[g].Id==d[f].Id&&c.splice(g,1);return c.length},J=function(a){for(var b=0,c=0;c<e.length;c++)e[c].myKey==a&&(b=e[c].count);return b};return{getSalesforce:E,data:b,forceData:d,forceresponse:c,arrResults:e,fetchForce:F}}]),myApp.factory("UserService",["$http","$window",function(a,b){var c=function(b){return a.post("/user/adduser",b).then(function(){return d().then(function(a){return a})})},d=function(){return a.get("/user/getusers").then(function(a){return a.data})},e=function(b){return a.get("/user/getuserdata/"+b).then(function(a){return a})},f=function(b){return a.put("/user/updateuser",b).then(function(){return d().then(function(a){return a})})},g=function(b){return a.post("/user/deleteuser",b).then(function(){return d().then(function(a){return a})})},h=function(b){return a.post("/user/saveuser").then(function(a){console.log(a)})},i=function(){return a.get("/user").then(function(a){var b={};return a.data===!1?(b.authenticated=!1,b):(a.data.admin===!0&&(b.admin=!0),b.firstname=a.data.firstname,b.lastname=a.data.lastname,b.authenticated=!0,b)})},j=function(){a.get("/logout").then(function(a){b.location.href="/"})};return{verifyUser:i,newUser:c,getUsers:d,getUserData:e,updateUser:f,deleteUser:g,saveUser:h,logout:j}}]);