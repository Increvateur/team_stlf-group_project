var myApp=angular.module("myApp",["ngRoute","ngAnimate","ui.bootstrap","smart-table"]);myApp.config(["$routeProvider","$locationProvider",function(a,b){a.when("/",{templateUrl:"assets/views/templates/home.html",controller:"HomeController"}).when("/queries",{templateUrl:"assets/views/templates/queries.html",controller:"QueryController"}).when("/failure",{templateUrl:"assets/views/templates/failure.html",controller:"MainController"}).when("/register",{templateUrl:"assets/views/templates/register.html",controller:"AddUserController"}).when("/goals",{templateUrl:"assets/views/templates/goals.html",controller:"GoalsController"}).when("/giftRange",{templateUrl:"assets/views/templates/giftRange.html",controller:"GiftRangeController"}).when("/donorRetention",{templateUrl:"assets/views/templates/donorRetention.html",controller:"DonorRetentionController"}).otherwise({redirectTo:"/"}),b.html5Mode(!0)}]),myApp.controller("AddUserController",["$scope","UserService",function(a,b){var c=b;a.addUser={},a.addUser.admin=!1,a.submit=function(b){c.newUser(b),a.addUser={}}}]),myApp.controller("ChartContentController",["$scope","$uibModalInstance","results",function(a,b,c){a.results=c,console.log("Inside the actual ChartContentController:",a.results),a.chartType=function(b){"piechart"==b?a.load=a.piechart:"bargraph"==b?a.load=a.bargraph:a.load=a.barchart},a.piechart=function(a){console.log("Pie Chart Data:",a),AmCharts.makeChart("chartdiv",{type:"pie",angle:20,balloonText:"[[title]]<br><span style='font-size:14px'><b>$[[value]]</b> ([[percents]]%)</span>",depth3D:20,titleField:"group",valueField:"money",fontSize:12,theme:"default",allLabels:[],balloon:{},titles:[{id:"goals",size:16,text:"Donations by Individuals"}],dataProvider:[{group:"Staff",money:6526},{group:"Board",money:9135},{group:"Committee",money:1480},{group:"Parents",money:10228},{group:"Alums",money:21262},{group:"Participants",money:2376},{group:"Community Support",money:22013}]})},a.bargraph=function(a){AmCharts.makeChart("chartdiv",{type:"serial",categoryField:"date",dataDateFormat:"YYYY-MM-DD",autoMarginOffset:40,marginRight:60,marginTop:60,fontSize:13,theme:"default",categoryAxis:{parseDates:!0},chartCursor:{enabled:!0},chartScrollbar:{enabled:!0},trendLines:[],graphs:[{columnWidth:.44,cornerRadiusTop:8,dashLength:4,fillAlphas:.51,id:"AmGraph-1",lineAlpha:.44,title:"graph 1",type:"column",valueField:"column-1"},{bullet:"square",bulletBorderAlpha:1,bulletBorderThickness:1,bulletSize:16,id:"AmGraph-2",lineThickness:3,title:"graph 2",valueField:"column-2"}],guides:[],valueAxes:[{id:"ValueAxis-1",title:""}],allLabels:[],balloon:{},titles:[],dataProvider:[{date:"2014-03-01","column-1":8,"column-2":5},{date:"2014-03-02","column-1":6,"column-2":7},{date:"2014-03-03","column-1":2,"column-2":3},{date:"2014-03-04","column-1":1,"column-2":3},{date:"2014-03-05","column-1":2,"column-2":1},{date:"2014-03-06","column-1":3,"column-2":2},{date:"2014-03-07","column-1":6,"column-2":8}]})},a.barchart=function(a){AmCharts.makeChart("chartdiv",{type:"serial",categoryField:"category",rotate:!0,angle:30,depth3D:30,startDuration:1,categoryAxis:{gridPosition:"start"},trendLines:[],graphs:[{balloonText:"[[title]] of [[category]]:[[value]]",fillAlphas:1,id:"AmGraph-1",title:"graph 1",type:"column",valueField:"column-1"},{balloonText:"[[title]] of [[category]]:[[value]]",fillAlphas:1,id:"AmGraph-2",title:"graph 2",type:"column",valueField:"column-2"}],guides:[],valueAxes:[{id:"ValueAxis-1",stackType:"regular",title:""}],allLabels:[],balloon:{},legend:{enabled:!0,useGraphSettings:!0},titles:[{id:"Title-1",size:15,text:"Chart Title"}],dataProvider:[{category:"category 1","column-1":8,"column-2":5},{category:"category 2","column-1":6,"column-2":7},{category:"category 3","column-1":2,"column-2":3}]})},a.load=a.piechart,a.close=function(){b.close()}}]),myApp.controller("DonorRetentionController",["$scope","$filter","$uibModal","DonorRetentionService",function(a,b,c,d){var e=d;a.rowCollection=[],a.itemsByPage=15,a.accounts=[],a.data=[],a.forceData=[],a.forceresponse=[],a.retained=[],a.recovered=[],a.universe=[],e.getDonors(),a.data=e.data,a.forceData=e.forceData,a.forceresponse=e.forceresponse,a.retained=e.retainedDonorsArray,a.recovered=e.recoveredDonorsArray,a.universe=e.universeArray,a.open=function(a){c.open({animation:!0,templateUrl:"./assets/views/routes/chartContent.html",controller:"ChartContentController",size:a,keyboard:!0,backdrop:"static"})}}]),myApp.controller("GiftRangeController",["$scope","$filter","$uibModal","GiftRangeService",function(a,b,c,d){var e=d;a.rowCollection=[],a.itemsByPage=15,a.gifts=[],a.data=[],a.forceData=[],a.forceresponse=[],a.amountRaised=[],e.giftRange(),a.gifts=e.giftArray,a.amountRaised=e.amountRaised,a.open=function(a){c.open({animation:!0,templateUrl:"./assets/views/routes/chartContent.html",controller:"ChartContentController",size:a,keyboard:!0,backdrop:"static"})}}]),myApp.controller("GoalsController",["$scope","GoalService",function(a,b){console.log("HI, @CONTROLLER - GoalsController Works!");var c=b;a.goalsArray=c.goalsArray,console.log("*** == @GoalsController - $scope.goalsArray: ",a.goalsArray),c.getGoals(),a.yearArray=[],c.setYearList(),console.log("<<< CURRENT YEAR & YEARS >>> : ",c.currentYear,c.years),a.yearArray=c.years,console.log("// === @GoalsController - $scope.yearArray: ",a.yearArray),a.goals={},a.monthsObj={months:[{name:"September",key:"september"},{name:"October",key:"october"},{name:"November",key:"november"},{name:"December",key:"december"},{name:"January",key:"january"},{name:"February",key:"february"},{name:"March",key:"march"},{name:"April",key:"april"},{name:"May",key:"may"},{name:"June",key:"june"},{name:"July",key:"july"},{name:"August",key:"august"}]},a.indTotal=0,a.yearlyTotal=0,a.year="",a.fiscalYear=function(b){return a.addFyKey(b),a.findYear(),a.goals.fiscalyear},a.addFyKey=function(b){return a.fiscalyear=b,a.goals.fiscalyear=a.fiscalyear,a.goals.fiscalyear},a.findYear=function(){console.log("HI, FISCAL YEAR: ",a.goals.fiscalyear),console.log("~ @goalController in findYear - $scope.goals: ",a.goals),c.getSpecificYear(a.goals.fiscalyear).then(function(b){a.goals=b,console.log("~~~~~~~~~~~~~~~~~~~<- $scope.goals",a.goals)})},a.saveGoals=function(b){console.log("@goalController.js fiscalyear: ",a.fiscalyear),console.log("! @goalController in saveGoals - data: ",b),c.newGoals(b),a.goals={},c.getGoals()},a.individualTotal=0,a.calcTotals=function(){console.log("=_-_= @goalsController in calcTotals"),a.goals.yearly_totals={};var b=a.goals,c=b.months,d=b.yearly_totals;console.log("~~ - ~~ @goalsController in calcTotals - goals, months, yearly_totals: ",b,c,d);var e,f,g,h,i=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0,t=0,u=0,v=0,w=0;for(h in c){f=c[h],console.log("~~~~ @@goalsController in for loop of calcTotals - month: ",f);var x=f.staff;isNaN(x)&&(x=0);var y=f.board;isNaN(y)&&(y=0);var z=f.committee;isNaN(z)&&(z=0);var A=f.parent;isNaN(A)&&(A=0);var B=f.alum;isNaN(B)&&(B=0);var C=f.participant;isNaN(C)&&(C=0);var D=f.community;isNaN(D)&&(D=0);var E=f.corporate_organization;isNaN(E)&&(E=0);var F=f.corporate_match;isNaN(F)&&(F=0);var G=f.corporate_foundation;isNaN(G)&&(G=0);var H=f.family_foundation;isNaN(H)&&(H=0);var I=f.general_foundation;isNaN(I)&&(I=0);var J=x+y+z+A+B+C+D;f.individual_total=J;var K=E+F;f.corporate_total=K;var L=G+H+I;f.foundation_total=L,console.log("HERE IS THE FOR LOOP @goalsController calcTotals() - months[i].all: ",x,y,z,A,B,C,D,J,E,F,K,L,G,H,I),g=J+K+L,console.log("% %  %   @@@goalsController in calcTotals - monthlyTotal in for loop: ",g),console.log("** - = @goalsController in calcTotals - $scope.goals: ",a.goals),f.monthly_total=g,i+=f.staff,console.log("+++ @goalsController in loop - staffTotal: ",i),d.staff_year=i,j+=f.board,d.board_year=j,k+=f.committee,d.committee_year=k,l+=f.parent,d.parent_year=l,m+=f.alum,d.alum_year=m,n+=f.participant,d.participant_year=n,o+=f.community,d.community_year=o,p+=f.individual_total,d.individual_year=p,r+=f.corporate_organization,d.corporate_organization_year=r,s+=f.corporate_match,d.corporate_match_year=s,q+=f.corporate_total,d.corporate_year=q,u+=f.corporate_foundation,d.corporate_foundation_year=u,v+=f.family_foundation,d.family_foundation_year=v,w+=f.general_foundation,d.general_foundation_year=w,t+=f.foundation_total,d.foundation_year=t,e=p+q+t,console.log("! - H E L L O  @goalsController in calcTotals in loop - yearlyTotal: ",e),d.year_total=e}},a.calcYearlyTotals=function(){console.log("=_-_= @goalsController in calcYearlyTotals");var b,c,d=a.goals.months,e=0,f=0,g=0,h=0,i=0,j=0,k=0,l=0,m=0,n=0,o=0;console.log("** ! = @goalsController in calcYearlyTotals - months before for loop: ",d);var p;for(p in d)b=d[p],console.log("~~~~ @@goalsController in for loop of calcYearlyTotals - month: ",b),e+=b.staff,isNaN(e)&&(e=0),f+=b.board,isNaN(f)&&(f=0),g+=b.committee,isNaN(g)&&(g=0),h+=b.parent,isNaN(h)&&(h=0),i+=b.alum,isNaN(i)&&(i=0),j+=b.participant,isNaN(j)&&(j=0),k+=b.community,isNaN(k)&&(k=0),l+=b.individual,isNaN(l)&&(l=0),m+=b.corporations,isNaN(m)&&(m=0),n+=b.foundations,isNaN(n)&&(n=0),o+=b.events,isNaN(o)&&(o=0),console.log("HERE IS THE FOR LOOP @goalsController calcYearlyTotals() - months[i].all: ",e,f,g,h,i,j,k,l,m,n,o),c=e+f+g+h+i+j+k+m+n+o,console.log("% %  %   @@@goalsController in calcYearlyTotals - totalGoals in for loop: ",c),a.yearlyTotal=c,console.log("@@@goalsController in calcYearlyTotals - $scope.yearlyTotal after for loop: ",a.yearlyTotal),d.yearly_total=a.yearlyTotal,c=0},a.calcIndTot=function(){var b,c=a.goals.months,d=0,e=0,f=0,g=0,h=0,i=0,j=0,k=0;console.log("** ! = @goalsController in calcIndTot - months before for loop: ",c);var l;for(l in c)b=c[l],console.log("~~~~ @@goalsController in for loop of calcIndTot - month: ",b),e+=b.staff,isNaN(e)&&(e=0),f+=b.board,isNaN(f)&&(f=0),g+=b.committee,isNaN(g)&&(g=0),h+=b.parent,isNaN(h)&&(h=0),i+=b.alum,isNaN(i)&&(i=0),j+=b.participant,isNaN(j)&&(j=0),k+=b.community,isNaN(k)&&(k=0),d=e+f+g+h+i+j+k,console.log("% %  %   @@@goalsController in calcIndTot - individualGoal in for loop: ",d),a.indTotal=d,console.log("@@@goalsController in calcIndTot - $scope.indTotal after for loop: ",a.indTotal),b.individual=a.indTotal,d=0,e=0,f=0,g=0,h=0,i=0,j=0,k=0,a.indTotal=0}}]),myApp.controller("HomeController",["$scope","$filter","$uibModal","MoneyRaisedService","GoalService",function(a,b,c,d,e){var f=d,g=e;a.rowCollection=[],a.itemsByPage=15,a.accounts=[],a.data=[],a.forceData=[],a.forceresponse=[],a.goals=[],a.getGoals=function(){a.goals=g.getGoals()},a.buildtable=function(){a.accounts=f.accountArray},a.open=function(a,b){console.log("Inside the Chart Open Function:",b);c.open({animation:!0,templateUrl:"./assets/views/routes/chartContent.html",controller:"ChartContentController",size:a,keyboard:!0,backdrop:"static",resolve:{results:function(){return b}}})},f.getTotals(),f.moneyRaised(),a.data=f.data,a.forceData=f.forceData,a.forceresponse=f.forceresponse,a.buildtable()}]),myApp.controller("loginController",["$scope","$uibModalInstance",function(a,b){a.close=function(){b.close()}}]),myApp.controller("MainController",["$scope","$http","UserService","$uibModal",function(a,b,c,d){var e=c;e.verifyUser().then(function(b){b.authenticated?(b.admin===!0?a.admin=!0:a.admin=!1,a.login=!0):(a.admin=!1,a.login=!1)}),a.open=function(a){d.open({animation:!0,templateUrl:"./assets/views/routes/loginModal.html",controller:"loginController",size:a,keyboard:!0})},a.logout=function(){e.logout()}}]),myApp.controller("QueryController",["$scope","QueryService",function(a,b){console.log("QueryControllerWorks"),a.data=[],a.forceData=[],a.forceresponse=[];b.getSalesforce(),a.data=b.data,a.forceData=b.forceData,console.log("forcedata",b.forceData),console.log("forcedata arrResults",b.forceData.arrResults),a.forceresponse=b.forceresponse}]),myApp.controller("UserController",["$scope","$http","UserService",function(a,b,c){var d=c;d.verifyUser().then(function(b){b.authenticated?(b.admin===!0?a.admin=!0:a.admin=!1,a.login=!0,a.user=b):(a.admin=!1,a.login=!1)})}]),myApp.factory("DonorRetentionService",["$http",function(a){var b={},c={},d={},e=[],f=[],g=0,h="",i=[],j=[],k=[],l={},m={},n={},o={},p={},q={},r={},s={},t={},u={},v={},w=new Date("12-31-2015"),x=new Date,y=new Date,z=new Date,A=new Date,B=new Date,C=new Date,D=new Date,E=new Date,F=new Date,G=new Date,H=new Date,I=new Date,J=new Date,K=new Date,L=new Date,M=new Date,N=new Date,O=new Date,P=new Date,Q="";y=new Date(w),x=new Date("09/01/"+w.getFullYear()),x>y&&(x=new Date("09/01/"+(w.getFullYear()-1))),z=new Date(x),z.add({years:-1}),B=new Date(x),B.add({years:-2}),D=new Date(x),D.add({years:-3}),F=new Date(x),F.add({years:-4}),A=new Date(y),A.add({years:-1}),C=new Date(y),C.add({years:-2}),E=new Date(y),E.add({years:-3}),G=new Date(y),G.add({years:-4}),I=new Date("08/31/"+w.getFullYear()),I>w&&(I=new Date("08/31/"+(w.getFullYear()-1))),K=new Date(I),K.add({years:-1}),M=new Date(I),M.add({years:-2}),O=new Date(I),O.add({years:-3}),P=new Date(I),P.add({years:-4}),H=new Date(z),J=new Date(B),L=new Date(D),N=new Date(F),w=w.toFormat("YYYY-MM-DD"),x=x.toFormat("YYYY-MM-DD"),y=y.toFormat("YYYY-MM-DD"),z=z.toFormat("YYYY-MM-DD"),A=A.toFormat("YYYY-MM-DD"),B=B.toFormat("YYYY-MM-DD"),C=C.toFormat("YYYY-MM-DD"),D=D.toFormat("YYYY-MM-DD"),E=E.toFormat("YYYY-MM-DD"),F=F.toFormat("YYYY-MM-DD"),G=G.toFormat("YYYY-MM-DD"),H=H.toFormat("YYYY-MM-DD"),I=I.toFormat("YYYY-MM-DD"),J=J.toFormat("YYYY-MM-DD"),K=K.toFormat("YYYY-MM-DD"),L=L.toFormat("YYYY-MM-DD"),M=M.toFormat("YYYY-MM-DD"),N=N.toFormat("YYYY-MM-DD"),O=O.toFormat("YYYY-MM-DD"),P=P.toFormat("YYYY-MM-DD");var R=function(){Q="c1",h="SELECT  COUNT(Id) FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' GROUP BY AccountId HAVING MIN(CloseDate) >= "+x+" AND MIN(CloseDate) <= "+y,sqlObj={key:Q,query:"first time donors  YTD SELECTED",sql:h},f.push(sqlObj),Q="c2",h="SELECT  COUNT(Id) FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' GROUP BY AccountId HAVING MIN(CloseDate) >= "+z+" AND MIN(CloseDate) <= "+A,sqlObj={key:Q,query:"first time donors  YTD SELECTED -1",sql:h},f.push(sqlObj),Q="c3",h="SELECT  COUNT(Id) FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' GROUP BY AccountId HAVING MIN(CloseDate) >= "+B+" AND MIN(CloseDate) <= "+C,sqlObj={key:Q,query:"first time donors  YTD SELECTED -2",sql:h},f.push(sqlObj),Q="c4",h="SELECT  COUNT(Id) FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' GROUP BY AccountId HAVING MIN(CloseDate) >= "+H+" AND MIN(CloseDate) <= "+I,sqlObj={key:Q,query:"first time donors  First FY before selected",sql:h},f.push(sqlObj),Q="c5",h="SELECT  COUNT(Id) FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' GROUP BY AccountId HAVING MIN(CloseDate) >= "+J+" AND MIN(CloseDate) <= "+K,sqlObj={key:Q,query:"first time donors  Second FY before selected",sql:h},f.push(sqlObj),Q="d1",h="SELECT Id, Name FROM Account WHERE Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate >= "+x+" AND CloseDate < ="+y+")",h+="AND  Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate > ="+J+" AND CloseDate < ="+I+") ",sqlObj={key:Q,query:"CURRENT RETAINED YTD new def",sql:h},f.push(sqlObj),Q="d2",h="SELECT Id, Name FROM Account WHERE Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate >= "+z+" AND CloseDate <= "+A+")",h+="AND  Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate >= "+L+" AND CloseDate <= "+K+") ",sqlObj={key:Q,query:"CURRENT RETAINED YTD-1 new def",sql:h},f.push(sqlObj),Q="d3",h="SELECT Id, Name FROM Account WHERE Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate >= "+B+" AND CloseDate <= "+C+")",h+="AND  Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate >= "+N+" AND CloseDate <= "+M+") ",sqlObj={key:Q,query:"CURRENT RETAINED YTD-2 new def",sql:h},f.push(sqlObj),Q="d4",h="SELECT Id, Name FROM Account WHERE Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate >= "+H+" AND CloseDate <= "+I+")",h+="AND  Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate > ="+L+" AND CloseDate <= "+K+") ",sqlObj={key:Q,query:"CURRENT RETAINED FYM1",sql:h},f.push(sqlObj),Q="d5",h="SELECT Id, Name FROM Account WHERE Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate >= "+J+" AND CloseDate <= "+K+")",h+="AND  Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate > ="+N+" AND CloseDate <= "+M+") ",sqlObj={key:Q,query:"CURRENT RETAINED FYM2",sql:h},f.push(sqlObj),Q="e1",h="SELECT Id, Name FROM Account WHERE Id NOT IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate >= "+x+" AND CloseDate <= "+y+")",h+="AND  Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate >= "+J+" AND CloseDate < ="+I+") ",sqlObj={key:Q,query:"l2ybnty YTD new def",sql:h},f.push(sqlObj),Q="e2",h="SELECT Id, Name FROM Account WHERE Id NOT IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate >= "+z+" AND CloseDate <= "+A+")",h+="AND  Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate >= "+L+" AND CloseDate <= "+K+") ",sqlObj={key:Q,query:"l2ybnty YTD-1 new def",sql:h},f.push(sqlObj),Q="e3",h="SELECT Id, Name FROM Account WHERE Id NOT IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate >= "+B+" AND CloseDate <= "+C+")",h+="AND  Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate >= "+N+" AND CloseDate <= "+M+") ",sqlObj={key:Q,query:"l2ybnty YTD-2 new def",sql:h},f.push(sqlObj),Q="e4",h="SELECT Id, Name FROM Account WHERE Id NOT IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate >= "+H+" AND CloseDate <= "+I+")",h+="AND  Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate >= "+L+" AND CloseDate <= "+K+") ",sqlObj={key:Q,query:"l2ybnty FYM1",sql:h},f.push(sqlObj),Q="e5",h="SELECT Id, Name FROM Account WHERE Id NOT IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate >= "+J+" AND CloseDate <= "+K+")",h+="AND  Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate >= "+N+" AND CloseDate <= "+M+") ",sqlObj={key:Q,query:"l2ybnty FYM2",sql:h},f.push(sqlObj),Q="f1a",h="SELECT Id, Name FROM Account WHERE Id  IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate > "+x+" AND CloseDate < "+y+")",h+="AND  Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate < "+M+") ",sqlObj={key:Q,query:"donated in sel yetd, AND  sometime prior to the previous two fiscal years",sql:h},f.push(sqlObj),Q="f1b",h="SELECT Id, Name FROM Account WHERE Id  IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate > "+J+" AND CloseDate < "+I+")",sqlObj={key:Q,query:"donated in the previous 2 fiscal years",sql:h},f.push(sqlObj),Q="f2a",h="SELECT Id, Name FROM Account WHERE Id  IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate > "+z+" AND CloseDate < "+A+")",h+="AND  Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate < "+O+") ",sqlObj={key:Q,query:"donated in sel yetd-1, AND  sometime prior to the previous two fiscal years",sql:h},f.push(sqlObj),Q="f2b",h="SELECT Id, Name FROM Account WHERE Id  IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate > "+L+" AND CloseDate < "+K+")",sqlObj={key:Q,query:"donated in the previous 2 fiscal years",sql:h},f.push(sqlObj),Q="f3a",h="SELECT Id, Name FROM Account WHERE Id  IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate > "+B+" AND CloseDate < "+C+")",h+="AND  Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate < "+P+") ",sqlObj={key:Q,query:"donated in sel yetd-1, AND  sometime prior to the previous two fiscal years",sql:h},f.push(sqlObj),Q="f3b",h="SELECT Id, Name FROM Account WHERE Id  IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate > "+N+" AND CloseDate < "+M+")",sqlObj={key:Q,query:"donated in the previous 2 fiscal years",sql:h},f.push(sqlObj),Q="f4a",h="SELECT Id, Name FROM Account WHERE Id  IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate > "+H+" AND CloseDate < "+I+")",h+="AND  Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate < "+L+") ",sqlObj={key:Q,query:"donated in sel yetd-1, AND  sometime prior to the previous two fiscal years",sql:h},f.push(sqlObj),Q="f5a",h="SELECT Id, Name FROM Account WHERE Id  IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate > "+J+" AND CloseDate < "+K+")",h+="AND  Id IN (SELECT AccountId FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate < "+N+") ",sqlObj={key:Q,query:"donated in sel yetd-1, AND  sometime prior to the previous two fiscal years",sql:h},f.push(sqlObj),Q="g1",h="SELECT AccountId,  COUNT(Id) FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' GROUP BY AccountId HAVING MAX(CloseDate) <= "+M,sqlObj={key:Q,query:"lost ytd (how is this yeartd)",sql:h},f.push(sqlObj),Q="g2",h="SELECT  COUNT(Id) FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' GROUP BY AccountId HAVING MAX(CloseDate) <= "+O,sqlObj={key:Q,query:"lost ytd-1 (how is this yeartd)",sql:h},f.push(sqlObj),Q="g3",h="SELECT  COUNT(Id) FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' GROUP BY AccountId HAVING MAX(CloseDate) <= "+P,sqlObj={key:Q,query:"lost ytd-2 (how is this yeartd)",sql:h},f.push(sqlObj),S()},S=function(b){c.accessToken?(console.log("DID NOT reauthroize"),T()):(console.log("I want to do a check in getSalesforce to see if I need to auth. ",c.accessToken),a.get("/salesforce/force").then(function(a){c.response=a.data,c.accessToken=a.data.accessToken,c.instanceUrl=a.data.instanceUrl,T()}))},T=function(b){return console.log("in fetch force, forceResult=",b),b&&(e.push(b.data),g=e.length,console.log("sql index",g),e.length==f.length)?(console.log("Hey! In fetchForce in queryService, I think we are done!"),d.arrResults=e,U(),void console.log(d)):void a.get("/salesforce/fetch",{params:{accessToken:c.accessToken,instanceUrl:c.instanceUrl,key:f[g].key,strSql:f[g].sql,queryInfo:f[g].query}}).then(function(a){T(a)})},U=function(){console.log("Hey we are totally in parseResults"),console.log("Donor	Acquistion	&	Retention"),console.log("first time donors");var a=W("c1"),b=W("c2"),c=W("c3"),d=W("c4"),e=W("c5");l={type:"First Time Donors",ytd:a,ytdM1:b,ytdM2:c,tfyM1:d,tfyM2:e},i[0]=l,console.log("Current retained donors");var f=W("d1"),g=W("d2"),h=W("d3"),w=W("d4"),x=W("d5");m={type:"Current Retained Donors",ytd:f,ytdM1:g,ytdM2:h,tfyM1:w,tfyM2:x},i[1]=m,console.log("L2YBNTY");var y=W("e1"),z=W("e2"),A=W("e3"),B=W("e4"),C=W("e5");n={type:"L2YBNTY",ytd:y,ytdM1:z,ytdM2:A,tfyM1:B,tfyM2:C},i[2]=n,console.log("Total current donor pool");var D=a+f+y,E=b+g+z,F=c+h+A,G=d+w+B,H=e+x+C;o={type:"Total Current Donor Pool",ytd:D,ytdM1:E,ytdM2:F,tfyM1:G,tfyM2:H},i[3]=o,console.log("Current retained donors percentage");var I=f/D*100,J=g/E*100,K=h/F*100,L=w/G*100,M=x/H*100;p={type:"% Current Retained Donors",ytd:I,ytdM1:J,ytdM2:K,tfyM1:L,tfyM2:M},i[4]=p,console.log("retained array in function",i),console.log("Recovered Donors");var N=V("f1a","f1b"),O=V("f2a","f2b"),P=V("f3a","f3b"),Q=V("f4a","f2b"),R=V("f5a","f3b");q={type:"Recovered Donors",ytd:N,ytdM1:O,ytdM2:P,tfyM1:Q,tfyM2:R},j[0]=q,console.log("Lost Donors");var S=W("g1"),T=W("g2"),U=W("g3"),X=W("g1"),Y=W("g2");r={type:"Lost Donors",ytd:S,ytdM1:T,ytdM2:U,tfyM1:X,tfyM2:Y},j[1]=r,console.log("Total lost recovery  pool");var Z=N+S,$=O+T,_=P+U,aa=Q+X,ba=R+Y;s={type:"Total Lost/Recovery Pool",ytd:Z,ytdM1:$,ytdM2:_,tfyM1:aa,tfyM2:ba},j[2]=s,console.log("Percentage donors recovered");var ca=N/S*100,da=O/T*100,ea=P/U*100,fa=Q/X*100,ga=R/Y*100;t={type:"% of Donors Recovered",ytd:ca,ytdM1:da,ytdM2:ea,tfyM1:fa,tfyM2:ga},j[3]=t,console.log("recovered array in function",j),console.log("Donor Universe");var ha=D+Z,ia=E+$,ja=F+_,ka=G+aa,la=H+ba;u={type:"Total Donor Universe",ytd:ha,ytdM1:ia,ytdM2:ja,tfyM1:ka,tfyM2:la},k[0]=u,console.log("Percentage retained donors");var ma=ha/f*100,na=ia/g*100,oa=ja/h*100,pa=ka/w*100,qa=la/x*100;v={type:"% of Retained Donors",ytd:ma,ytdM1:na,ytdM2:oa,tfyM1:pa,tfyM2:qa},k[1]=v,console.log("universeArray",k)},V=function(a,b){for(var c=[],d=[],f=0;f<e.length;f++)e[f].myKey==a&&(c=e[f].result.records),e[f].myKey==b&&(d=e[f].result.records);for(f=0;f<d.length;f++)for(var g=0;g<c.length;g++)c[g].Id==d[f].Id&&c.splice(g,1);return c.length},W=function(a){for(var b=0,c=0;c<e.length;c++)e[c].myKey==a&&(b=e[c].count);return b};return{getSalesforce:S,getDonors:R,data:b,forceData:d,forceresponse:c,arrResults:e,fetchForce:T,retainedDonorsArray:i,recoveredDonorsArray:j,universeArray:k}}]),myApp.factory("GiftRangeService",["$http",function(a){function b(a,b,c,d,e,f){this.type=a,this.ytd=b,this.ytdM1=c,this.ytdM2=d,this.tfyM1=e,this.tfyM2=f,k.push(this)}var c={},d={},e={},f=[],g=[],h=0,i="",j="",k=[],l=[],m={},n={},o={},p={},q={},r=new Date("12-31-2015"),s=new Date,t=new Date,u=new Date,v=new Date,w=new Date,y=new Date,z=new Date,A=new Date,B=new Date,C=new Date,D=new Date,E=new Date,F=new Date,G=new Date,H=new Date,I=new Date,J=new Date,K=new Date,L=new Date;t=new Date(r),s=new Date("09/01/"+r.getFullYear()),s>t&&(s=new Date("09/01/"+(r.getFullYear()-1))),u=new Date(s),u.add({years:-1}),w=new Date(s),w.add({years:-2}),z=new Date(s),z.add({years:-3}),B=new Date(s),B.add({years:-4}),v=new Date(t),v.add({years:-1}),y=new Date(t),y.add({years:-2}),A=new Date(t),A.add({years:-3}),C=new Date(t),C.add({years:-4}),E=new Date("08/31/"+r.getFullYear()),E>r&&(E=new Date("08/31/"+(r.getFullYear()-1))),G=new Date(E),G.add({years:-1}),I=new Date(E),I.add({years:-2}),K=new Date(E),K.add({years:-3}),L=new Date(E),L.add({years:-4}),D=new Date(u),F=new Date(w),H=new Date(z),J=new Date(B),r=r.toFormat("YYYY-MM-DD"),s=s.toFormat("YYYY-MM-DD"),t=t.toFormat("YYYY-MM-DD"),u=u.toFormat("YYYY-MM-DD"),v=v.toFormat("YYYY-MM-DD"),w=w.toFormat("YYYY-MM-DD"),y=y.toFormat("YYYY-MM-DD"),z=z.toFormat("YYYY-MM-DD"),A=A.toFormat("YYYY-MM-DD"),B=B.toFormat("YYYY-MM-DD"),C=C.toFormat("YYYY-MM-DD"),D=D.toFormat("YYYY-MM-DD"),E=E.toFormat("YYYY-MM-DD"),F=F.toFormat("YYYY-MM-DD"),G=G.toFormat("YYYY-MM-DD"),H=H.toFormat("YYYY-MM-DD"),I=I.toFormat("YYYY-MM-DD"),J=J.toFormat("YYYY-MM-DD"),K=K.toFormat("YYYY-MM-DD"),L=L.toFormat("YYYY-MM-DD");var M=function(){j="m1",i="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate >="+s+" AND CloseDate < ="+t+" GROUP BY AccountId HAVING ( SUM(Amount) <= 95 )  ",sqlObj={key:j,query:"BASE donors Selected YTD",sql:i},g.push(sqlObj),j="m2",i="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND CloseDate >= "+u+" AND CloseDate < ="+v+" GROUP BY AccountId HAVING ( SUM(Amount) <= 95  )  ",sqlObj={key:j,query:"BASE donors Selected YTD -1",sql:i},g.push(sqlObj),j="m3",i="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+w+" AND CloseDate < ="+y+" GROUP BY AccountId HAVING ( SUM(Amount) <= 95 )  ",sqlObj={key:j,query:"BASE donors Selected YTD -2",sql:i},g.push(sqlObj),j="m4",i="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+D+" AND CloseDate < ="+E+" GROUP BY AccountId HAVING ( SUM(Amount) <= 95 )  ",sqlObj={key:j,query:"BASE donors first FY before selected",sql:i},g.push(sqlObj),j="m5",i="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+F+" AND CloseDate < ="+G+" GROUP BY AccountId HAVING ( SUM(Amount) <= 95 )  ",sqlObj={key:j,query:"BASE donors SECOND FY before selected",sql:i},g.push(sqlObj),j="n1",i="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+s+" AND CloseDate < ="+t+" GROUP BY AccountId HAVING ( SUM(Amount) < 400 AND SUM(Amount) > 95 )  ",sqlObj={key:j,query:"INTERMEDIATE donors Selected YTD",sql:i},g.push(sqlObj),j="n2",i="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+u+" AND CloseDate < ="+v+" GROUP BY AccountId HAVING ( SUM(Amount) < 400 AND SUM(Amount) > 95 )  ",sqlObj={key:j,query:"INTERMEDIATE donors Selected YTD -1",sql:i},g.push(sqlObj),j="n3",i="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+w+" AND CloseDate < ="+y+" GROUP BY AccountId HAVING ( SUM(Amount) < 400 AND SUM(Amount) > 95 )  ",sqlObj={key:j,query:"INTERMEDIATE donors Selected YTD -2",sql:i},g.push(sqlObj),j="n4",i="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+D+" AND CloseDate < ="+E+" GROUP BY AccountId HAVING ( SUM(Amount) < 400 AND SUM(Amount) > 95 ) ",sqlObj={key:j,query:"INTERMEDIATE donors first FY before selected",sql:i},g.push(sqlObj),j="n5",i="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+F+" AND CloseDate < ="+G+" GROUP BY AccountId HAVING ( SUM(Amount) < 400 AND SUM(Amount) > 95 )  ",sqlObj={key:j,query:"INTERMEDIATE donors SECOND FY before selected",sql:i},g.push(sqlObj),j="o1",i="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+s+" AND CloseDate < ="+t+" GROUP BY AccountId HAVING ( SUM(Amount) < 1000 AND SUM(Amount) >= 400 )  ",sqlObj={key:j,query:"LARGE donors Selected YTD",sql:i},g.push(sqlObj),j="o2",i="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+u+" AND CloseDate < ="+v+" GROUP BY AccountId HAVING ( SUM(Amount) < 1000 AND SUM(Amount) >= 400 )  ",sqlObj={key:j,query:"LARGE donors Selected YTD -1",sql:i},g.push(sqlObj),j="o3",i="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+w+" AND CloseDate < ="+y+" GROUP BY AccountId HAVING ( SUM(Amount) < 1000 AND SUM(Amount) >= 400 )  ",
sqlObj={key:j,query:"LARGE donors Selected YTD -2",sql:i},g.push(sqlObj),j="o4",i="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+D+" AND CloseDate < ="+E+" GROUP BY AccountId HAVING ( SUM(Amount) < 1000 AND SUM(Amount) >= 400 ) ",sqlObj={key:j,query:"LARGE donors first FY before selected",sql:i},g.push(sqlObj),j="o5",i="SELECT   COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+F+" AND CloseDate < ="+G+" GROUP BY AccountId HAVING ( SUM(Amount) < 1000 AND SUM(Amount) >= 400 )  ",sqlObj={key:j,query:"LARGE donors SECOND FY before selected",sql:i},g.push(sqlObj),j="p1",i="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+s+" AND CloseDate < ="+t+" GROUP BY AccountId HAVING (  SUM(Amount) >= 1000 )  ",sqlObj={key:j,query:"MAJOR donors Selected YTD",sql:i},g.push(sqlObj),j="p2",i="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+u+" AND CloseDate < ="+v+" GROUP BY AccountId HAVING (  SUM(Amount) >= 1000 )  ",sqlObj={key:j,query:"MAJOR donors Selected YTD -1",sql:i},g.push(sqlObj),j="p3",i="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+w+" AND CloseDate < ="+y+" GROUP BY AccountId HAVING (  SUM(Amount) >= 1000 )  ",sqlObj={key:j,query:"MAJOR donors Selected YTD -2",sql:i},g.push(sqlObj),j="p4",i="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+D+" AND CloseDate < ="+E+" GROUP BY AccountId HAVING (  SUM(Amount) >= 1000 )  ",sqlObj={key:j,query:"MAJOR donors first FY before selected",sql:i},g.push(sqlObj),j="p5",i="SELECT   COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+F+" AND CloseDate < ="+G+" GROUP BY AccountId HAVING (  SUM(Amount) >= 1000 )  ",sqlObj={key:j,query:"MAJOR donors SECOND FY before selected",sql:i},g.push(sqlObj),j="q1",i="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+s+" AND CloseDate < ="+t+" GROUP BY AccountId HAVING (  SUM(Amount) >= 0 )  ",sqlObj={key:j,query:"TOTAL donors Selected YTD",sql:i},g.push(sqlObj),j="q2",i="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+u+" AND CloseDate < ="+v+" GROUP BY AccountId HAVING (  SUM(Amount) >= 0 )  ",sqlObj={key:j,query:"TOTAL donors Selected YTD -1",sql:i},g.push(sqlObj),j="q3",i="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+w+" AND CloseDate < ="+y+" GROUP BY AccountId HAVING (  SUM(Amount) >= 0 )  ",sqlObj={key:j,query:"TOTAL donors Selected YTD -2",sql:i},g.push(sqlObj),j="q4",i="SELECT  COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+D+" AND CloseDate < ="+E+" GROUP BY AccountId HAVING (  SUM(Amount) >= 0 )  ",sqlObj={key:j,query:"TOTAL donors first FY before selected",sql:i},g.push(sqlObj),j="q5",i="SELECT   COUNT(Id), SUM(Amount) FROM Opportunity WHERE  StageName = 'Posted' AND RecordTypeID = '012800000002KPtAAM' AND  CloseDate >= "+F+" AND CloseDate < ="+G+" GROUP BY AccountId HAVING (  SUM(Amount) >= 0 )  ",sqlObj={key:j,query:"TOTAL donors SECOND FY before selected",sql:i},g.push(sqlObj),N()},N=function(b){d.accessToken?(console.log("DID NOT reauthroize"),O()):(console.log("I want to do a check in getSalesforce to see if I need to auth. ",d.accessToken),a.get("/salesforce/force").then(function(a){d.response=a.data,d.accessToken=a.data.accessToken,d.instanceUrl=a.data.instanceUrl,O()}))},O=function(b){return b&&(f.push(b.data),h=f.length,console.log("sql index",h),f.length==g.length)?(console.log("Hey! In fetchForce in queryService, I think we are done!"),e.arrResults=f,P(),console.log(e),void S(e.arrResults)):void a.get("/salesforce/fetch",{params:{accessToken:d.accessToken,instanceUrl:d.instanceUrl,key:g[h].key,strSql:g[h].sql,queryInfo:g[h].query}}).then(function(a){O(a)})},P=function(){console.log("Gift Range Chart"),console.log("Donors at each level"),console.log("Base");R("m1"),R("m2"),R("m3"),R("m4"),R("m5");console.log("Inter");R("n1"),R("n2"),R("n3"),R("n4"),R("n5");console.log("Large");R("o1"),R("o2"),R("o3"),R("o4"),R("o5");console.log("Major");R("p1"),R("p2"),R("p3"),R("p4"),R("p5");console.log("Total Donors");console.log("gift range amounts"),console.log("Base");var a=Q("m1"),b=Q("m2"),c=Q("m3"),d=Q("m4"),e=Q("m5");m={type:"base",ytd:a,ytdM1:b,ytdM2:c,tfyM1:d,tfyM2:e},l[0]=m,console.log("intermediate");var f=Q("n1"),g=Q("n2"),h=Q("n3"),i=Q("n4"),j=Q("n5");n={type:"Intermediate",ytd:f,ytdM1:g,ytdM2:h,tfyM1:i,tfyM2:j},l[1]=n,console.log("Large");var k=Q("o1"),r=Q("o2"),s=Q("o3"),t=Q("o4"),u=Q("o5");o={type:"Large",ytd:k,ytdM1:r,ytdM2:s,tfyM1:t,tfyM2:u},l[2]=o,console.log(l),console.log("major");var v=Q("p1"),w=Q("p2"),x=Q("p3"),y=Q("p4"),z=Q("p5");p={type:"Major",ytd:v,ytdM1:w,ytdM2:x,tfyM1:y,tfyM2:z},l[3]=p,console.log("Total");var A=Q("q1"),B=Q("q2"),C=Q("q3"),D=Q("q4"),E=Q("q5");q={type:"Total",ytd:A,ytdM1:B,ytdM2:C,tfyM1:D,tfyM2:E},l[4]=q,console.log(l)},Q=function(a){for(var b=0;b<f.length;b++)if(f[b].myKey==a){var c=f[b].result.records,d=0;for(x=0;x<c.length;x++)d+=c[x].expr1;return d}},R=function(a){for(var b=0,c=0;c<f.length;c++)f[c].myKey==a&&(b=f[c].count);return b},S=function(a){if(f=[],g=[],Sqlobj={},h=0,j="",i="",console.log("hit sort results",a),k.length>0)return console.log("all done.");for(var c=0;c<a.length;c+=5)new b(a[c].queryInfo,a[c].count,a[c+1].count,a[c+2].count,a[c+3].count,a[c+4].count);console.log("did this actually work?!?!?",k)};return{getSalesforce:N,giftRange:M,data:c,forceData:e,forceresponse:d,arrResults:f,fetchForce:O,giftArray:k,amountRaised:l}}]),myApp.factory("GoalService",["$http",function(a){var b=[],c=function(b){console.log("*@FACTORY goalService, newGoals(addGoals): ",b),a.post("/goals/postgoals",b).then(function(a){console.log("@GoalService in newGoals function after post - response: ",a)})},d=function(){a.get("/goals/getgoals").then(function(a){console.log("@GoalService in getGoals() - response from server: ",a),b=a.data,console.log("!-@GoalService in getGoals() - goalsArray: ",b)})},e=new Date;e=e.getFullYear();var f=e,g=2003,h=f+5,i=h,j=[],k=function(){for(var a=h;i>=g;)j.push(a),a--,i--},l=function(b){return console.log("<><> GET @goalService.js in getSpecificYear(year) - year: ",b),a.get("goals/"+b).then(function(a){return a.data})};return{newGoals:c,getGoals:d,getSpecificYear:l,goalsArray:b,setYearList:k,currentYear:f,years:j}}]),myApp.factory("MoneyRaisedService",["$http",function(a){function b(a,b,c,d,e,f){this.type=a,this.ytd=b,this.ytdM1=c,this.ytdM2=d,this.tfyM1=e,this.tfyM2=f,this.goal=0,this.percentOfGoal=0,this.percentToGoal=0,k.push(this)}var c={},d={},e={},f=[],g=[],h=0,i="",j="",k=[],l={},m=[],n=[],o=0,p={},q=new Date("12-31-2015"),r=new Date,s=new Date,t=new Date,u=new Date,v=new Date,w=new Date,x=new Date,y=new Date,z=new Date,A=new Date,B=new Date,C=new Date,D=new Date,E=new Date;s=new Date(q),r=new Date("09/01/"+q.getFullYear()),r>s&&(r=new Date("09/01/"+(q.getFullYear()-1))),t=new Date(r),t.add({years:-1}),v=new Date(r),v.add({years:-2}),x=new Date(r),x.add({years:-3}),z=new Date(r),z.add({years:-4}),u=new Date(s),u.add({years:-1}),w=new Date(s),w.add({years:-2}),y=new Date(s),y.add({years:-3}),A=new Date(s),A.add({years:-4}),C=new Date("08/31/"+q.getFullYear()),C>q&&(C=new Date("08/31/"+(q.getFullYear()-1))),E=new Date(C),E.add({years:-1}),B=new Date(t),D=new Date(v),q=q.toFormat("YYYY-MM-DD"),r=r.toFormat("YYYY-MM-DD"),s=s.toFormat("YYYY-MM-DD"),t=t.toFormat("YYYY-MM-DD"),u=u.toFormat("YYYY-MM-DD"),v=v.toFormat("YYYY-MM-DD"),w=w.toFormat("YYYY-MM-DD"),x=x.toFormat("YYYY-MM-DD"),y=y.toFormat("YYYY-MM-DD"),z=z.toFormat("YYYY-MM-DD"),A=A.toFormat("YYYY-MM-DD"),B=B.toFormat("YYYY-MM-DD"),C=C.toFormat("YYYY-MM-DD"),D=D.toFormat("YYYY-MM-DD"),E=E.toFormat("YYYY-MM-DD");var F=function(){i="a1",j="SELECT Donation_SubCategory__c, SUM(Amount) FROM  Opportunity WHERE StageName = 'Posted' AND Amount != null AND CloseDate >= "+r+" AND CloseDate <="+s+"  GROUP BY Donation_SubCategory__c ",sqlObj={key:i,query:"money raised YTD START AND END RATE this is NEW SPARTA",sql:j},g.push(sqlObj),i="a2",j="SELECT Donation_SubCategory__c, SUM(Amount) FROM  Opportunity WHERE StageName = 'Posted' AND Amount != null AND CloseDate >= "+t+" AND CloseDate <="+u+"  GROUP BY Donation_SubCategory__c ",sqlObj={key:i,query:"year -1 money raised YTD START AND END RATE this is NEW SPARTA",sql:j},g.push(sqlObj),i="a3",j="SELECT Donation_SubCategory__c, SUM(Amount) FROM  Opportunity WHERE StageName = 'Posted' AND Amount != null AND CloseDate >= "+v+" AND CloseDate <="+w+"  GROUP BY Donation_SubCategory__c ",sqlObj={key:i,query:"year -2 money raised YTD START AND END RATE this is NEW SPARTA",sql:j},g.push(sqlObj),i="a4",j="SELECT Donation_SubCategory__c, SUM(Amount) FROM  Opportunity WHERE StageName = 'Posted' AND Amount != null AND CloseDate >= "+B+" AND CloseDate <="+C+"  GROUP BY Donation_SubCategory__c ",sqlObj={key:i,query:"First Fiscal YEar before select date",sql:j},g.push(sqlObj),i="a5",j="SELECT Donation_SubCategory__c, SUM(Amount) FROM  Opportunity WHERE StageName = 'Posted' AND Amount != null AND CloseDate >= "+D+" AND CloseDate <="+E+"  GROUP BY Donation_SubCategory__c ",sqlObj={key:i,query:"SECOND Fiscal YEar before select date",sql:j},g.push(sqlObj),J()},G=function(){i="b1",j="SELECT  SUM(Amount) FROM  Opportunity WHERE StageName = 'Posted' AND Amount != null AND CloseDate >= "+r+" AND CloseDate <="+s,sqlObj={key:i,query:"TOTAL amount for ytd selected",sql:j},m.push(sqlObj),i="b2",j="SELECT  SUM(Amount) FROM  Opportunity WHERE StageName = 'Posted' AND Amount != null AND CloseDate >= "+t+" AND CloseDate <="+u,sqlObj={key:i,query:"TOTAL amount for ytd selected -1",sql:j},m.push(sqlObj),i="b3",j="SELECT  SUM(Amount) FROM  Opportunity WHERE StageName = 'Posted' AND Amount != null AND CloseDate >= "+v+" AND CloseDate <="+w,sqlObj={key:i,query:"TOTAL amount for ytd selected -2",sql:j},m.push(sqlObj),i="b4",j="SELECT  SUM(Amount) FROM  Opportunity WHERE StageName = 'Posted' AND Amount != null AND CloseDate >= "+B+" AND CloseDate <="+C,sqlObj={key:i,query:"TOTAL amount for First full fiscal year before selected",sql:j},m.push(sqlObj),i="b5",j="SELECT  SUM(Amount) FROM  Opportunity WHERE StageName = 'Posted' AND Amount != null AND CloseDate >= "+D+" AND CloseDate <="+E,sqlObj={key:i,query:"TOTAL amount for Second full fiscal year before selected",sql:j},m.push(sqlObj),H()},H=function(b){d.accessToken?(console.log("DID NOT reauthroize"),I()):a.get("/salesforce/force").then(function(a){d.response=a.data,d.accessToken=a.data.accessToken,d.instanceUrl=a.data.instanceUrl,I()})},I=function(b){return console.log("in total force, forceResult=",b),b&&(n.push(b.data),o=n.length,console.log("sql index",o),n.length==m.length)?void(p.totalarrResults=n):void a.get("/salesforce/fetch",{params:{accessToken:d.accessToken,instanceUrl:d.instanceUrl,key:m[o].key,strSql:m[o].sql,queryInfo:m[o].query}}).then(function(a){I(a)})},J=function(b){d.accessToken?(console.log("DID NOT reauthroize"),K()):a.get("/salesforce/force").then(function(a){d.response=a.data,d.accessToken=a.data.accessToken,d.instanceUrl=a.data.instanceUrl,K()})},K=function(b){return b&&(f.push(b.data),h=f.length,console.log("sql index",h),f.length==g.length)?(e.arrResults=f,M("2015"),void L(f)):void a.get("/salesforce/fetch",{params:{accessToken:d.accessToken,instanceUrl:d.instanceUrl,key:g[h].key,strSql:g[h].sql,queryInfo:g[h].query}}).then(function(a){K(a)})},L=function(a){if(f=[],g=[],Sqlobj={},h=0,i="",j="",k.length>0)return console.log("all done.");var c={};c.total=[];for(var d=0;d<a.length;d++)if(a[d].result.records.length>12)for(var e=0;e<a[d].result.records.length;e++)null===a[d].result.records[e].Donation_SubCategory__c&&a[d].result.records.splice(e,1);for(var l=0;l<a[0].result.records.length;l++)c.type=a[0].result.records[l].Donation_SubCategory__c,c.total[0]=a[0].result.records[l].expr0,c.total[1]=a[1].result.records[l].expr0,c.total[2]=a[2].result.records[l].expr0,c.total[3]=a[3].result.records[l].expr0,c.total[4]=a[4].result.records[l].expr0,new b(c.type,c.total[0],c.total[1],c.total[2],c.total[3],c.total[4]);console.log("did this actually work?!?!?",k)},M=function(b){a.get("/goals/getYear/"+b).then(function(a){console.log("getting goals in money raised ",a.data),l.object=a.data,N()})},N=function(){console.log("goals in set goals function",l),k[0].goal=l.object[0].months.september.staff,k[1].goal=l.object[0].months.september.board,k[2].goal=l.object[0].months.september.committee,k[3].goal=l.object[0].months.september.parent,k[4].goal=l.object[0].months.september.alum,k[5].goal=l.object[0].months.september.participant,k[6].goal=l.object[0].months.september.community,k[7].goal=l.object[0].months.september.corporate_organization,k[8].goal=l.object[0].months.september.corporate_match,k[9].goal=l.object[0].months.september.corporate_foundation,k[10].goal=l.object[0].months.september.family_foundation,k[11].goal=l.object[0].months.september.general_foundation,O(k),P(k)},O=function(a){for(var b=0;b<a.length;b++){var c=a[b].ytd,d=a[b].goal,e=c/d;e=100*e,e=Math.round(e),a[b].percentToGoal=e}},P=function(a){console.log("ytd total",p.totalarrResults[0].result.records[0].expr0);var b=p.totalarrResults[0].result.records[0].expr0;b=Math.round(b),console.log(b);for(var c=0,d=0;d<a.length;d++){c=a[d].ytd,console.log("current goal",c);var e=c/b;e=100*e,e=Math.round(e),console.log(e),a[d].percentOfGoal=e}};return{getSalesforce:J,moneyRaised:F,data:c,forceData:e,forceresponse:d,arrResults:f,fetchForce:K,accountArray:k,getTotals:G}}]),myApp.factory("UserService",["$http","$window",function(a,b){var c=function(b){console.log("-@FACTORY userServcie.js newUser(data) = ",b),a.post("/user/adduser",b).then(function(a){console.log("@userService - newUser function *** after post - response: ",a)})},d=function(){return a.get("/user").then(function(a){var b={};return a.data===!1?(b.authenticated=!1,b):(a.data.admin===!0&&(b.admin=!0),b.firstname=a.data.firstname,b.lastname=a.data.lastname,b.authenticated=!0,b)})},e=function(){a.get("/logout").then(function(a){console.log(a),b.location.href="/"})};return{newUser:c,verifyUser:d,logout:e}}]);